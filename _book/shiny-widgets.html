<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 17 Widgets with Shiny | JavaScript for R</title>
  <meta name="description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 17 Widgets with Shiny | JavaScript for R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="github-repo" content="JohnCoene/javascript-for-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 17 Widgets with Shiny | JavaScript for R" />
  
  <meta name="twitter:description" content="Invite JavaScript into your Data Science workflow." />
  

<meta name="author" content="John Coene" />


<meta name="date" content="2021-04-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="shiny-cookies.html"/>
<link rel="next" href="v8.html"/>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<script src="libs/core-js-2.5.3/shim.min.js"></script>
<script src="libs/react-16.12.0/react.min.js"></script>
<script src="libs/react-16.12.0/react-dom.min.js"></script>
<script src="libs/reactwidget-1.0.0/react-tools.js"></script>
<script src="libs/reactable-binding-0.2.3/reactable.js"></script>
<script src="libs/r2d3-render-0.1.0/r2d3-render.js"></script>
<script src="libs/webcomponents-2.0.0/webcomponents.js"></script>
<script src="libs/r2d3-binding-0.2.5/r2d3.js"></script>
<script src="libs/d3v6-6.2.0/d3.min.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.17/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-74544116-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74544116-1');
</script>
<meta property="og:title" content="Chapter 17 Widgets with Shiny | JavaScript for R">
<meta property="og:description" content="Book on using JavaScript with R for visualisations, web development, and computations.">
<meta property="og:image" content="https://book.javascript-for-r.com/images/social.png">
<meta property="og:url" content="https://book.javascript-for-r.com/">
<meta name="twitter:card" content="summary_large_image">
<meta property="og:site_name" content="Chapter 17 Widgets with Shiny | JavaScript for R">
<meta name="twitter:image:alt" content="Book on using JavaScript with R for visualisations, web development, and computations.">
<meta name="twitter:site" content="@jdatap">


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">JavaScript for R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#premise"><i class="fa fa-check"></i>Premise</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>Book Structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgement"><i class="fa fa-check"></i>Acknowledgement</a></li>
</ul></li>
<li class="part"><span><b>I Basics and Roadmap</b></span></li>
<li class="chapter" data-level="1" data-path="intro-overview.html"><a href="intro-overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="intro-overview.html"><a href="intro-overview.html#intro-overview-rationale"><i class="fa fa-check"></i><b>1.1</b> Rationale</a></li>
<li class="chapter" data-level="1.2" data-path="intro-overview.html"><a href="intro-overview.html#intro-methods"><i class="fa fa-check"></i><b>1.2</b> Methods</a><ul>
<li class="chapter" data-level="1.2.1" data-path="intro-overview.html"><a href="intro-overview.html#intro-v8"><i class="fa fa-check"></i><b>1.2.1</b> V8</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro-overview.html"><a href="intro-overview.html#intro-htmlwidgets"><i class="fa fa-check"></i><b>1.2.2</b> htmlwidgets</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro-overview.html"><a href="intro-overview.html#intro-shiny"><i class="fa fa-check"></i><b>1.2.3</b> Shiny</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro-overview.html"><a href="intro-overview.html#intro-amiss"><i class="fa fa-check"></i><b>1.3</b> Methods Amiss</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro-overview.html"><a href="intro-overview.html#intro-reactr-vuer"><i class="fa fa-check"></i><b>1.3.1</b> reactR &amp; vueR</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro-overview.html"><a href="intro-overview.html#intro-r2d3"><i class="fa fa-check"></i><b>1.3.2</b> r2d3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>2</b> Prerequisites</a><ul>
<li class="chapter" data-level="2.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-package-dev"><i class="fa fa-check"></i><b>2.1</b> R Package Development</a><ul>
<li class="chapter" data-level="2.1.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-create-pkg"><i class="fa fa-check"></i><b>2.1.1</b> Creating a Package</a></li>
<li class="chapter" data-level="2.1.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-metadata"><i class="fa fa-check"></i><b>2.1.2</b> Metadata</a></li>
<li class="chapter" data-level="2.1.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-r-code"><i class="fa fa-check"></i><b>2.1.3</b> R code</a></li>
<li class="chapter" data-level="2.1.4" data-path="prerequisites.html"><a href="prerequisites.html#basics-documentation"><i class="fa fa-check"></i><b>2.1.4</b> Documentation</a></li>
<li class="chapter" data-level="2.1.5" data-path="prerequisites.html"><a href="prerequisites.html#basics-installed-files"><i class="fa fa-check"></i><b>2.1.5</b> Installed files</a></li>
<li class="chapter" data-level="2.1.6" data-path="prerequisites.html"><a href="prerequisites.html#basics-build-load-install"><i class="fa fa-check"></i><b>2.1.6</b> Build, load, and install</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-json"><i class="fa fa-check"></i><b>2.2</b> JSON</a><ul>
<li class="chapter" data-level="2.2.1" data-path="prerequisites.html"><a href="prerequisites.html#serialising"><i class="fa fa-check"></i><b>2.2.1</b> Serialising</a></li>
<li class="chapter" data-level="2.2.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-tabular"><i class="fa fa-check"></i><b>2.2.2</b> Tabular Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-javascript"><i class="fa fa-check"></i><b>2.3</b> JavaScript</a><ul>
<li class="chapter" data-level="2.3.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-chrome-devtools"><i class="fa fa-check"></i><b>2.3.1</b> Developer Tools</a></li>
<li class="chapter" data-level="2.3.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-var-scope"><i class="fa fa-check"></i><b>2.3.2</b> Variable Declaration and Scope</a></li>
<li class="chapter" data-level="2.3.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-object-model"><i class="fa fa-check"></i><b>2.3.3</b> Document Object Model</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="prerequisites.html"><a href="prerequisites.html#basics-shiny"><i class="fa fa-check"></i><b>2.4</b> Shiny</a><ul>
<li class="chapter" data-level="2.4.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-static-files"><i class="fa fa-check"></i><b>2.4.1</b> Serving Static Files</a></li>
<li class="chapter" data-level="2.4.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-htmltools"><i class="fa fa-check"></i><b>2.4.2</b> Htmltools</a></li>
<li class="chapter" data-level="2.4.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-deps-pro-cons"><i class="fa fa-check"></i><b>2.4.3</b> Serving vs. htmltools</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Data Visualisation</b></span></li>
<li class="chapter" data-level="3" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html"><i class="fa fa-check"></i><b>3</b> Introduction to Widgets</a><ul>
<li class="chapter" data-level="3.1" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-plotly"><i class="fa fa-check"></i><b>3.1</b> Plotly package</a></li>
<li class="chapter" data-level="3.2" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-intro-dt"><i class="fa fa-check"></i><b>3.2</b> DT package</a></li>
<li class="chapter" data-level="3.3" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-intro-crosstalk"><i class="fa fa-check"></i><b>3.3</b> Crosstalk</a></li>
<li class="chapter" data-level="3.4" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-intro-conclude"><i class="fa fa-check"></i><b>3.4</b> Wrap-up</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="widgets-basics.html"><a href="widgets-basics.html"><i class="fa fa-check"></i><b>4</b> Basics of Building Widgets</a><ul>
<li class="chapter" data-level="4.1" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-study"><i class="fa fa-check"></i><b>4.1</b> Read and Study</a></li>
<li class="chapter" data-level="4.2" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates"><i class="fa fa-check"></i><b>4.2</b> Candidate Libraries</a><ul>
<li class="chapter" data-level="4.2.1" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates-plotly"><i class="fa fa-check"></i><b>4.2.1</b> Plotly.js</a></li>
<li class="chapter" data-level="4.2.2" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates-highcharts"><i class="fa fa-check"></i><b>4.2.2</b> Highchart.js</a></li>
<li class="chapter" data-level="4.2.3" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates-chart.js"><i class="fa fa-check"></i><b>4.2.3</b> Chart.js</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-inner-workings"><i class="fa fa-check"></i><b>4.3</b> How It Works</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="widgets-first.html"><a href="widgets-first.html"><i class="fa fa-check"></i><b>5</b> Your First Widget</a><ul>
<li class="chapter" data-level="5.1" data-path="widgets-first.html"><a href="widgets-first.html#widgets-first-scaffold"><i class="fa fa-check"></i><b>5.1</b> The Scaffold</a></li>
<li class="chapter" data-level="5.2" data-path="widgets-first.html"><a href="widgets-first.html#widgets-first-htmloutput"><i class="fa fa-check"></i><b>5.2</b> The HTML Output</a></li>
<li class="chapter" data-level="5.3" data-path="widgets-first.html"><a href="widgets-first.html#widgets-first-js-files"><i class="fa fa-check"></i><b>5.3</b> JavaScript Files</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="widgets-realistic.html"><a href="widgets-realistic.html"><i class="fa fa-check"></i><b>6</b> A Realistic Widget</a><ul>
<li class="chapter" data-level="6.1" data-path="widgets-realistic.html"><a href="widgets-realistic.html#widgets-realistic-deps"><i class="fa fa-check"></i><b>6.1</b> Dependencies</a></li>
<li class="chapter" data-level="6.2" data-path="widgets-realistic.html"><a href="widgets-realistic.html#widgets-realistic-implementation"><i class="fa fa-check"></i><b>6.2</b> Implementation</a></li>
<li class="chapter" data-level="6.3" data-path="widgets-realistic.html"><a href="widgets-realistic.html#widgets-realistic-html-element"><i class="fa fa-check"></i><b>6.3</b> HTML Element</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="widgets-full.html"><a href="widgets-full.html"><i class="fa fa-check"></i><b>7</b> The Full Monty</a><ul>
<li class="chapter" data-level="7.1" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-deps"><i class="fa fa-check"></i><b>7.1</b> Dependencies</a></li>
<li class="chapter" data-level="7.2" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-js"><i class="fa fa-check"></i><b>7.2</b> JavaScript</a></li>
<li class="chapter" data-level="7.3" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-data"><i class="fa fa-check"></i><b>7.3</b> Working with Data</a></li>
<li class="chapter" data-level="7.4" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data"><i class="fa fa-check"></i><b>7.4</b> Transforming Data</a><ul>
<li class="chapter" data-level="7.4.1" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-js"><i class="fa fa-check"></i><b>7.4.1</b> Using JavaScript</a></li>
<li class="chapter" data-level="7.4.2" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-modify"><i class="fa fa-check"></i><b>7.4.2</b> Modify Serialiser</a></li>
<li class="chapter" data-level="7.4.3" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-replace"><i class="fa fa-check"></i><b>7.4.3</b> Replace Serialiser</a></li>
<li class="chapter" data-level="7.4.4" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-modify-data"><i class="fa fa-check"></i><b>7.4.4</b> Modify the Data</a></li>
<li class="chapter" data-level="7.4.5" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-conclusion"><i class="fa fa-check"></i><b>7.4.5</b> Pros and Cons</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-on-print"><i class="fa fa-check"></i><b>7.5</b> On Print Method</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="widgets-adv.html"><a href="widgets-adv.html"><i class="fa fa-check"></i><b>8</b> Advanced Topics</a><ul>
<li class="chapter" data-level="8.1" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-shared"><i class="fa fa-check"></i><b>8.1</b> Shared Variables</a><ul>
<li class="chapter" data-level="8.1.1" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-sizing"><i class="fa fa-check"></i><b>8.1.1</b> Sizing</a></li>
<li class="chapter" data-level="8.1.2" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-sizing-policy"><i class="fa fa-check"></i><b>8.1.2</b> Sizing Policy</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-resizing"><i class="fa fa-check"></i><b>8.2</b> Resizing</a></li>
<li class="chapter" data-level="8.3" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-prerender"><i class="fa fa-check"></i><b>8.3</b> Pre Render Hooks and Security</a></li>
<li class="chapter" data-level="8.4" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-js"><i class="fa fa-check"></i><b>8.4</b> JavaScript Code</a></li>
<li class="chapter" data-level="8.5" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-prepend-append"><i class="fa fa-check"></i><b>8.5</b> Prepend and Append Content</a></li>
<li class="chapter" data-level="8.6" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-dependencies"><i class="fa fa-check"></i><b>8.6</b> Dependencies</a></li>
<li class="chapter" data-level="8.7" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-compatibility"><i class="fa fa-check"></i><b>8.7</b> Compatibility</a></li>
<li class="chapter" data-level="8.8" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-unit-tests"><i class="fa fa-check"></i><b>8.8</b> Unit Tests</a></li>
<li class="chapter" data-level="8.9" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-performances"><i class="fa fa-check"></i><b>8.9</b> Performances</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="linking-widgets.html"><a href="linking-widgets.html"><i class="fa fa-check"></i><b>9</b> Linking Widgets</a><ul>
<li class="chapter" data-level="9.1" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-examples"><i class="fa fa-check"></i><b>9.1</b> Crosstalk Examples</a></li>
<li class="chapter" data-level="9.2" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-req"><i class="fa fa-check"></i><b>9.2</b> Crosstalk Requirements</a></li>
<li class="chapter" data-level="9.3" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-inner-workings"><i class="fa fa-check"></i><b>9.3</b> How it Works</a><ul>
<li class="chapter" data-level="9.3.1" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-keys"><i class="fa fa-check"></i><b>9.3.1</b> Keys</a></li>
<li class="chapter" data-level="9.3.2" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-communication-lines"><i class="fa fa-check"></i><b>9.3.2</b> Communication Lines</a></li>
<li class="chapter" data-level="9.3.3" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-groups"><i class="fa fa-check"></i><b>9.3.3</b> Groups</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-gio"><i class="fa fa-check"></i><b>9.4</b> Crosstalk with Gio</a></li>
<li class="chapter" data-level="9.5" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-r"><i class="fa fa-check"></i><b>9.5</b> R code</a></li>
<li class="chapter" data-level="9.6" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-js"><i class="fa fa-check"></i><b>9.6</b> JavaScript Code</a><ul>
<li class="chapter" data-level="9.6.1" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-send-keys"><i class="fa fa-check"></i><b>9.6.1</b> Send Selected Keys</a></li>
<li class="chapter" data-level="9.6.2" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-set-keys"><i class="fa fa-check"></i><b>9.6.2</b> Set Selected Keys</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-using"><i class="fa fa-check"></i><b>9.7</b> Using Crosstalk with Gio</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="widgets-final.html"><a href="widgets-final.html"><i class="fa fa-check"></i><b>10</b> Final Revisions</a><ul>
<li class="chapter" data-level="10.1" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-data"><i class="fa fa-check"></i><b>10.1</b> Htmlwidgets and Data</a></li>
<li class="chapter" data-level="10.2" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-options"><i class="fa fa-check"></i><b>10.2</b> Plethora of Options</a></li>
<li class="chapter" data-level="10.3" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-interface"><i class="fa fa-check"></i><b>10.3</b> Interface Design</a></li>
<li class="chapter" data-level="10.4" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-exercises"><i class="fa fa-check"></i><b>10.4</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>III Web Development with Shiny</b></span></li>
<li class="chapter" data-level="11" data-path="shiny-intro.html"><a href="shiny-intro.html"><i class="fa fa-check"></i><b>11</b> Bidirectional Communication</a><ul>
<li class="chapter" data-level="11.1" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-websocket"><i class="fa fa-check"></i><b>11.1</b> WebSocket an Shiny</a></li>
<li class="chapter" data-level="11.2" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-sessions"><i class="fa fa-check"></i><b>11.2</b> Sessions</a></li>
<li class="chapter" data-level="11.3" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-example"><i class="fa fa-check"></i><b>11.3</b> Alerts, an example</a><ul>
<li class="chapter" data-level="11.3.1" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-explore"><i class="fa fa-check"></i><b>11.3.1</b> Explore</a></li>
<li class="chapter" data-level="11.3.2" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-r-to-js"><i class="fa fa-check"></i><b>11.3.2</b> From R to JavaScript</a></li>
<li class="chapter" data-level="11.3.3" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-serialise"><i class="fa fa-check"></i><b>11.3.3</b> Serialisation</a></li>
<li class="chapter" data-level="11.3.4" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-js2r"><i class="fa fa-check"></i><b>11.3.4</b> JavaScript to R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="shiny-complete.html"><a href="shiny-complete.html"><i class="fa fa-check"></i><b>12</b> A Complete Integration</a><ul>
<li class="chapter" data-level="12.1" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-discover"><i class="fa fa-check"></i><b>12.1</b> Discover</a></li>
<li class="chapter" data-level="12.2" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-setup"><i class="fa fa-check"></i><b>12.2</b> Setup</a></li>
<li class="chapter" data-level="12.3" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-dependencies"><i class="fa fa-check"></i><b>12.3</b> Dependencies</a></li>
<li class="chapter" data-level="12.4" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-images"><i class="fa fa-check"></i><b>12.4</b> Static Files</a></li>
<li class="chapter" data-level="12.5" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-skeleton"><i class="fa fa-check"></i><b>12.5</b> Skeleton</a></li>
<li class="chapter" data-level="12.6" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-r2js"><i class="fa fa-check"></i><b>12.6</b> From R to JavaScript</a></li>
<li class="chapter" data-level="12.7" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-js2r"><i class="fa fa-check"></i><b>12.7</b> From JavaScript to R</a></li>
<li class="chapter" data-level="12.8" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-input-handler"><i class="fa fa-check"></i><b>12.8</b> Input handler</a></li>
<li class="chapter" data-level="12.9" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg"><i class="fa fa-check"></i><b>12.9</b> As a Package</a><ul>
<li class="chapter" data-level="12.9.1" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-deps"><i class="fa fa-check"></i><b>12.9.1</b> Dependencies</a></li>
<li class="chapter" data-level="12.9.2" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-trigger"><i class="fa fa-check"></i><b>12.9.2</b> Trigger classification</a></li>
<li class="chapter" data-level="12.9.3" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-js-code"><i class="fa fa-check"></i><b>12.9.3</b> JavaScript code</a></li>
<li class="chapter" data-level="12.9.4" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-input-handler"><i class="fa fa-check"></i><b>12.9.4</b> Input handler</a></li>
<li class="chapter" data-level="12.9.5" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-test"><i class="fa fa-check"></i><b>12.9.5</b> Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="shiny-tips.html"><a href="shiny-tips.html"><i class="fa fa-check"></i><b>13</b> Tips and Tricks</a><ul>
<li class="chapter" data-level="13.1" data-path="shiny-tips.html"><a href="shiny-tips.html#shiny-tips-events"><i class="fa fa-check"></i><b>13.1</b> Shiny Events</a></li>
<li class="chapter" data-level="13.2" data-path="shiny-tips.html"><a href="shiny-tips.html#shiny-tips-table-btn"><i class="fa fa-check"></i><b>13.2</b> Table Buttons</a></li>
<li class="chapter" data-level="13.3" data-path="shiny-tips.html"><a href="shiny-tips.html#shiny-tips-jQuery"><i class="fa fa-check"></i><b>13.3</b> jQuery</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="shiny-output.html"><a href="shiny-output.html"><i class="fa fa-check"></i><b>14</b> Custom Outputs</a><ul>
<li class="chapter" data-level="14.1" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-inner-workings"><i class="fa fa-check"></i><b>14.1</b> Inner-workings</a></li>
<li class="chapter" data-level="14.2" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-setup"><i class="fa fa-check"></i><b>14.2</b> Setup</a></li>
<li class="chapter" data-level="14.3" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-r-fun"><i class="fa fa-check"></i><b>14.3</b> Output R Function</a></li>
<li class="chapter" data-level="14.4" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-html"><i class="fa fa-check"></i><b>14.4</b> Generate Output HTML</a></li>
<li class="chapter" data-level="14.5" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-renderer"><i class="fa fa-check"></i><b>14.5</b> Output Renderer</a></li>
<li class="chapter" data-level="14.6" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-binding"><i class="fa fa-check"></i><b>14.6</b> JavaScript Output Binding</a><ul>
<li class="chapter" data-level="14.6.1" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-boxxy-title"><i class="fa fa-check"></i><b>14.6.1</b> Boxxy Title</a></li>
<li class="chapter" data-level="14.6.2" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-boxxy-value"><i class="fa fa-check"></i><b>14.6.2</b> Boxxy Value</a></li>
<li class="chapter" data-level="14.6.3" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-boxxy-bg-color"><i class="fa fa-check"></i><b>14.6.3</b> Boxxy Background Color</a></li>
<li class="chapter" data-level="14.6.4" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-register"><i class="fa fa-check"></i><b>14.6.4</b> Register the Output Binding</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-usage"><i class="fa fa-check"></i><b>14.7</b> Boxxy Usage</a></li>
<li class="chapter" data-level="14.8" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-inject"><i class="fa fa-check"></i><b>14.8</b> Injecting Dependencies</a></li>
<li class="chapter" data-level="14.9" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-preprocess"><i class="fa fa-check"></i><b>14.9</b> Preprocessing Custom Outputs</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="shiny-input.html"><a href="shiny-input.html"><i class="fa fa-check"></i><b>15</b> Custom Inputs</a><ul>
<li class="chapter" data-level="15.1" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-setup"><i class="fa fa-check"></i><b>15.1</b> Setup</a></li>
<li class="chapter" data-level="15.2" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-intro"><i class="fa fa-check"></i><b>15.2</b> Switch Input HTML and Style</a></li>
<li class="chapter" data-level="15.3" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-html"><i class="fa fa-check"></i><b>15.3</b> Generate Input HTML</a></li>
<li class="chapter" data-level="15.4" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-binding"><i class="fa fa-check"></i><b>15.4</b> JavaScript Input Binding</a><ul>
<li class="chapter" data-level="15.4.1" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-find"><i class="fa fa-check"></i><b>15.4.1</b> Find Inputs</a></li>
<li class="chapter" data-level="15.4.2" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-get-id"><i class="fa fa-check"></i><b>15.4.2</b> Get Input Id</a></li>
<li class="chapter" data-level="15.4.3" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-get-value"><i class="fa fa-check"></i><b>15.4.3</b> Get Input Value</a></li>
<li class="chapter" data-level="15.4.4" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-set-value"><i class="fa fa-check"></i><b>15.4.4</b> Set Input Value</a></li>
<li class="chapter" data-level="15.4.5" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-receive-msg"><i class="fa fa-check"></i><b>15.4.5</b> Receive Input Messages</a></li>
<li class="chapter" data-level="15.4.6" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-sub-unsub"><i class="fa fa-check"></i><b>15.4.6</b> Subscribe and Unsubscribe Inputs</a></li>
<li class="chapter" data-level="15.4.7" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-rate-policy"><i class="fa fa-check"></i><b>15.4.7</b> Input Rate Policy</a></li>
<li class="chapter" data-level="15.4.8" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-register"><i class="fa fa-check"></i><b>15.4.8</b> Registering the Input Binding</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-update"><i class="fa fa-check"></i><b>15.5</b> Update Input</a></li>
<li class="chapter" data-level="15.6" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-excercise"><i class="fa fa-check"></i><b>15.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="shiny-cookies.html"><a href="shiny-cookies.html"><i class="fa fa-check"></i><b>16</b> Cookies</a><ul>
<li class="chapter" data-level="16.1" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-discover"><i class="fa fa-check"></i><b>16.1</b> Discover js-cookie</a></li>
<li class="chapter" data-level="16.2" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-setup"><i class="fa fa-check"></i><b>16.2</b> Setup Project</a></li>
<li class="chapter" data-level="16.3" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-javascript"><i class="fa fa-check"></i><b>16.3</b> JavaScript Cookies</a></li>
<li class="chapter" data-level="16.4" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-r-code"><i class="fa fa-check"></i><b>16.4</b> R Code</a></li>
<li class="chapter" data-level="16.5" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-exercises"><i class="fa fa-check"></i><b>16.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="shiny-widgets.html"><a href="shiny-widgets.html"><i class="fa fa-check"></i><b>17</b> Widgets with Shiny</a><ul>
<li class="chapter" data-level="17.1" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-to-r"><i class="fa fa-check"></i><b>17.1</b> Widgets to R</a></li>
<li class="chapter" data-level="17.2" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-handlers"><i class="fa fa-check"></i><b>17.2</b> Input Handlers for Widgets</a></li>
<li class="chapter" data-level="17.3" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-r-to-widgets"><i class="fa fa-check"></i><b>17.3</b> R to Widgets</a><ul>
<li class="chapter" data-level="17.3.1" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-send-data"><i class="fa fa-check"></i><b>17.3.1</b> Send Data from Widgets</a></li>
<li class="chapter" data-level="17.3.2" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-retrieve"><i class="fa fa-check"></i><b>17.3.2</b> Retrieve Widget Instance</a></li>
<li class="chapter" data-level="17.3.3" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-handle-data"><i class="fa fa-check"></i><b>17.3.3</b> Handle Data</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-proxy"><i class="fa fa-check"></i><b>17.4</b> Proxy Function</a></li>
<li class="chapter" data-level="17.5" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-clear-data"><i class="fa fa-check"></i><b>17.5</b> Clear Data</a></li>
<li class="chapter" data-level="17.6" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-update"><i class="fa fa-check"></i><b>17.6</b> Update the Widget</a></li>
</ul></li>
<li class="part"><span><b>IV JavaScript for Computations</b></span></li>
<li class="chapter" data-level="18" data-path="v8.html"><a href="v8.html"><i class="fa fa-check"></i><b>18</b> The V8 Engine</a><ul>
<li class="chapter" data-level="18.1" data-path="v8.html"><a href="v8.html#v8-installation"><i class="fa fa-check"></i><b>18.1</b> Installation</a></li>
<li class="chapter" data-level="18.2" data-path="v8.html"><a href="v8.html#v8-basics"><i class="fa fa-check"></i><b>18.2</b> Basics</a></li>
<li class="chapter" data-level="18.3" data-path="v8.html"><a href="v8.html#v8-external"><i class="fa fa-check"></i><b>18.3</b> External Libraries</a></li>
<li class="chapter" data-level="18.4" data-path="v8.html"><a href="v8.html#v8-npm"><i class="fa fa-check"></i><b>18.4</b> NPM Packages</a></li>
<li class="chapter" data-level="18.5" data-path="v8.html"><a href="v8.html#v8-pkg"><i class="fa fa-check"></i><b>18.5</b> Use in Packages</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="v8-ml.html"><a href="v8-ml.html"><i class="fa fa-check"></i><b>19</b> Machine Learning</a><ul>
<li class="chapter" data-level="19.1" data-path="v8-ml.html"><a href="v8-ml.html#v8-ml-dependency"><i class="fa fa-check"></i><b>19.1</b> Dependency</a></li>
<li class="chapter" data-level="19.2" data-path="v8-ml.html"><a href="v8-ml.html#v8-ml-regression"><i class="fa fa-check"></i><b>19.2</b> Simple Regression</a></li>
<li class="chapter" data-level="19.3" data-path="v8-ml.html"><a href="v8-ml.html#v8-ml-exercises"><i class="fa fa-check"></i><b>19.3</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>V Robust JavaScript</b></span></li>
<li class="chapter" data-level="20" data-path="webpack-intro.html"><a href="webpack-intro.html"><i class="fa fa-check"></i><b>20</b> Managing JavaScript</a><ul>
<li class="chapter" data-level="20.1" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-example"><i class="fa fa-check"></i><b>20.1</b> Example</a></li>
<li class="chapter" data-level="20.2" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-browser"><i class="fa fa-check"></i><b>20.2</b> Transpiling</a></li>
<li class="chapter" data-level="20.3" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-minification"><i class="fa fa-check"></i><b>20.3</b> Minification</a></li>
<li class="chapter" data-level="20.4" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-structure"><i class="fa fa-check"></i><b>20.4</b> Bundling and Modules</a></li>
<li class="chapter" data-level="20.5" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-decouple"><i class="fa fa-check"></i><b>20.5</b> Decoupling</a></li>
<li class="chapter" data-level="20.6" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-npm"><i class="fa fa-check"></i><b>20.6</b> NPM</a></li>
<li class="chapter" data-level="20.7" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-conclude"><i class="fa fa-check"></i><b>20.7</b> With R</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html"><i class="fa fa-check"></i><b>21</b> Discover Webpack and NPM</a><ul>
<li class="chapter" data-level="21.1" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install"><i class="fa fa-check"></i><b>21.1</b> Installation</a><ul>
<li class="chapter" data-level="21.1.1" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-mac"><i class="fa fa-check"></i><b>21.1.1</b> Mac OS</a></li>
<li class="chapter" data-level="21.1.2" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-ubuntu"><i class="fa fa-check"></i><b>21.1.2</b> Ubuntu</a></li>
<li class="chapter" data-level="21.1.3" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-windows"><i class="fa fa-check"></i><b>21.1.3</b> Windows</a></li>
<li class="chapter" data-level="21.1.4" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-other"><i class="fa fa-check"></i><b>21.1.4</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-setup"><i class="fa fa-check"></i><b>21.2</b> Set Up the App</a></li>
<li class="chapter" data-level="21.3" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-init-npm"><i class="fa fa-check"></i><b>21.3</b> Initialise NPM</a></li>
<li class="chapter" data-level="21.4" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-pkgs"><i class="fa fa-check"></i><b>21.4</b> Installing NPM Packages</a></li>
<li class="chapter" data-level="21.5" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-entry-points"><i class="fa fa-check"></i><b>21.5</b> Entry Point and Output</a></li>
<li class="chapter" data-level="21.6" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-conf"><i class="fa fa-check"></i><b>21.6</b> Configuration File</a></li>
<li class="chapter" data-level="21.7" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-npm-scripts"><i class="fa fa-check"></i><b>21.7</b> NPM scripts</a></li>
<li class="chapter" data-level="21.8" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-webpack-mode"><i class="fa fa-check"></i><b>21.8</b> Source maps</a></li>
<li class="chapter" data-level="21.9" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-bundle"><i class="fa fa-check"></i><b>21.9</b> Bundle</a></li>
<li class="chapter" data-level="21.10" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-internal-dependencies"><i class="fa fa-check"></i><b>21.10</b> Internal Dependencies</a></li>
<li class="chapter" data-level="21.11" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-external-dependencies"><i class="fa fa-check"></i><b>21.11</b> External Dependencies</a></li>
<li class="chapter" data-level="21.12" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-import-export"><i class="fa fa-check"></i><b>21.12</b> Import and Export</a><ul>
<li class="chapter" data-level="21.12.1" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-import-export-named"><i class="fa fa-check"></i><b>21.12.1</b> Named</a></li>
<li class="chapter" data-level="21.12.2" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-import-export-default"><i class="fa fa-check"></i><b>21.12.2</b> Default</a></li>
<li class="chapter" data-level="21.12.3" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-import-export-wrap-up"><i class="fa fa-check"></i><b>21.12.3</b> Wrap-up</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="packer-overview.html"><a href="packer-overview.html"><i class="fa fa-check"></i><b>22</b> Webpack with R</a><ul>
<li class="chapter" data-level="22.1" data-path="packer-overview.html"><a href="packer-overview.html#packer-principles"><i class="fa fa-check"></i><b>22.1</b> Principles of packer</a></li>
<li class="chapter" data-level="22.2" data-path="packer-overview.html"><a href="packer-overview.html#packer-scaffolds"><i class="fa fa-check"></i><b>22.2</b> Scaffolds</a></li>
<li class="chapter" data-level="22.3" data-path="packer-overview.html"><a href="packer-overview.html#packer-inputs"><i class="fa fa-check"></i><b>22.3</b> Inputs</a></li>
<li class="chapter" data-level="22.4" data-path="packer-overview.html"><a href="packer-overview.html#packer-r-file"><i class="fa fa-check"></i><b>22.4</b> R file</a></li>
<li class="chapter" data-level="22.5" data-path="packer-overview.html"><a href="packer-overview.html#packer-js-files"><i class="fa fa-check"></i><b>22.5</b> JavaScript Files</a></li>
<li class="chapter" data-level="22.6" data-path="packer-overview.html"><a href="packer-overview.html#packer-bundle"><i class="fa fa-check"></i><b>22.6</b> Bundle</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="packer-adv.html"><a href="packer-adv.html"><i class="fa fa-check"></i><b>23</b> Webpack Advanced</a><ul>
<li class="chapter" data-level="23.1" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-widgets"><i class="fa fa-check"></i><b>23.1</b> Widgets</a></li>
<li class="chapter" data-level="23.2" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-shiny-vue"><i class="fa fa-check"></i><b>23.2</b> Shiny with Vue and Bootstrap 4</a><ul>
<li class="chapter" data-level="23.2.1" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-shiny-vue-setup"><i class="fa fa-check"></i><b>23.2.1</b> Setup</a></li>
<li class="chapter" data-level="23.2.2" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-shiny-vue-bs4"><i class="fa fa-check"></i><b>23.2.2</b> Bootstrap 4 Installation</a></li>
<li class="chapter" data-level="23.2.3" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-shiny-vue-code"><i class="fa fa-check"></i><b>23.2.3</b> Vue Code</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Closing Remarks</b></span></li>
<li class="chapter" data-level="24" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>24</b> Conclusion</a><ul>
<li class="chapter" data-level="24.1" data-path="conclusion.html"><a href="conclusion.html#conclusion-performances"><i class="fa fa-check"></i><b>24.1</b> Performances</a></li>
<li class="chapter" data-level="24.2" data-path="conclusion.html"><a href="conclusion.html#conclusion-trial-and-error"><i class="fa fa-check"></i><b>24.2</b> Trial and Error</a></li>
<li class="chapter" data-level="24.3" data-path="conclusion.html"><a href="conclusion.html#conclusion-ux"><i class="fa fa-check"></i><b>24.3</b> Functionality and UX</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">JavaScript for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="shiny-widgets" class="section level1">
<h1><span class="header-section-number">Chapter 17</span> Widgets with Shiny</h1>
<p>We have seen how to make JavaScript and R communicate in Shiny applications by passing data from the server to the client and back. This chapter explores how to apply that to htmlwidgets so they can provide additional functionalities when used in Shiny applications.</p>
<p>To demonstrate how to integrate these functionalities in widgets, we shall implement them in the previously built gio package.</p>
<div id="shiny-widgets-to-r" class="section level2">
<h2><span class="header-section-number">17.1</span> Widgets to R</h2>
<p>In a previous chapter on <a href="linking-widgets.html#linking-widgets">Linking Widgets</a>, the topic of callback function was briefly explored. Gio.js provides a callback function that is fired every time a country is selected on globe; this is currently used to share said country with other widgets as part of the implementation with crosstalk. This callback function could also send data back to the R server where they could be used for many things like fetching more data on the selected country from a database or use that information to generate a Shiny UI element like displaying the flag of the selected country, and much, much more.</p>
<p>The callback function in the gio package currently looks like this; it only makes use of some of the data for crosstalk.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb316-1" title="1"><span class="co">// define callback function</span></a>
<a class="sourceLine" id="cb316-2" title="2"><span class="kw">function</span> <span class="at">callback</span> (selectedCountry<span class="op">,</span> relatedCountries) <span class="op">{</span></a>
<a class="sourceLine" id="cb316-3" title="3">  <span class="va">sel_handle</span>.<span class="at">set</span>([<span class="va">selectedCountry</span>.<span class="at">ISOCode</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb316-4" title="4"><span class="op">}</span></a>
<a class="sourceLine" id="cb316-5" title="5"></a>
<a class="sourceLine" id="cb316-6" title="6"><span class="co">// use callback function</span></a>
<a class="sourceLine" id="cb316-7" title="7"><span class="va">controller</span>.<span class="at">onCountryPicked</span>(callback)<span class="op">;</span></a></code></pre></div>
<p>We can make further use of this to define two different Shiny inputs; one for the selected country and another for its related edges.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb317-1" title="1"><span class="co">// gio.js</span></a>
<a class="sourceLine" id="cb317-2" title="2"><span class="co">// define callback function</span></a>
<a class="sourceLine" id="cb317-3" title="3"><span class="kw">function</span> <span class="at">callback</span> (selectedCountry<span class="op">,</span> relatedCountries) <span class="op">{</span></a>
<a class="sourceLine" id="cb317-4" title="4">  <span class="va">sel_handle</span>.<span class="at">set</span>([<span class="va">selectedCountry</span>.<span class="at">ISOCode</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb317-5" title="5">  <span class="va">Shiny</span>.<span class="at">setInputValue</span>(<span class="st">&#39;selected&#39;</span><span class="op">,</span> selectedCountry)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-6" title="6">  <span class="va">Shiny</span>.<span class="at">setInputValue</span>(<span class="st">&#39;related&#39;</span><span class="op">,</span> relatedCountries)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-7" title="7"><span class="op">}</span></a></code></pre></div>
<p>However, this will generate an issue experienced in a previous chapter; multiple gio visualisations in a single Shiny application would be defining the values of a single input. This can be remedied to by using the id of the  to generate the input name dynamically.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb318-1" title="1">renderValue<span class="op">:</span> <span class="kw">function</span>(x) <span class="op">{</span></a>
<a class="sourceLine" id="cb318-2" title="2"></a>
<a class="sourceLine" id="cb318-3" title="3">  <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(el)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-4" title="4">  <span class="va">controller</span>.<span class="at">addData</span>(<span class="va">x</span>.<span class="at">data</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-5" title="5">  <span class="va">controller</span>.<span class="at">setStyle</span>(<span class="va">x</span>.<span class="at">style</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-6" title="6"></a>
<a class="sourceLine" id="cb318-7" title="7">  <span class="co">// callback</span></a>
<a class="sourceLine" id="cb318-8" title="8">  <span class="kw">function</span> <span class="at">callback</span> (selectedCountry<span class="op">,</span> relatedCountries) <span class="op">{</span></a>
<a class="sourceLine" id="cb318-9" title="9">    <span class="va">sel_handle</span>.<span class="at">set</span>([<span class="va">selectedCountry</span>.<span class="at">ISOCode</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb318-10" title="10">    <span class="va">Shiny</span>.<span class="at">setInputValue</span>(<span class="va">el</span>.<span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_selected&#39;</span><span class="op">,</span> selectedCountry)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-11" title="11">    <span class="va">Shiny</span>.<span class="at">setInputValue</span>(<span class="va">el</span>.<span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_related&#39;</span><span class="op">,</span> relatedCountries)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb318-13" title="13"></a>
<a class="sourceLine" id="cb318-14" title="14">  <span class="va">controller</span>.<span class="at">onCountryPicked</span>(callback)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-15" title="15"></a>
<a class="sourceLine" id="cb318-16" title="16">  <span class="co">// render</span></a>
<a class="sourceLine" id="cb318-17" title="17">  <span class="va">controller</span>.<span class="at">init</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb318-18" title="18"></a>
<a class="sourceLine" id="cb318-19" title="19"><span class="op">}</span></a></code></pre></div>
<p>The package can then be installed with <code>devtools::install</code> so we can test these inputs in a Shiny application.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb319-1" title="1"><span class="kw">library</span>(gio)</a>
<a class="sourceLine" id="cb319-2" title="2"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb319-3" title="3"></a>
<a class="sourceLine" id="cb319-4" title="4"><span class="co"># large sample data</span></a>
<a class="sourceLine" id="cb319-5" title="5">url &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb319-6" title="6">  <span class="st">&quot;https://raw.githubusercontent.com/JohnCoene/&quot;</span>,</a>
<a class="sourceLine" id="cb319-7" title="7">  <span class="st">&quot;javascript-for-r/master/data/countries.json&quot;</span></a>
<a class="sourceLine" id="cb319-8" title="8">)</a>
<a class="sourceLine" id="cb319-9" title="9">arcs &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw">fromJSON</span>(url)</a>
<a class="sourceLine" id="cb319-10" title="10"></a>
<a class="sourceLine" id="cb319-11" title="11">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb319-12" title="12">  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>),</a>
<a class="sourceLine" id="cb319-13" title="13">  <span class="kw">fluidRow</span>(</a>
<a class="sourceLine" id="cb319-14" title="14">    <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;selectedCountry&quot;</span>)),</a>
<a class="sourceLine" id="cb319-15" title="15">    <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;relatedCountries&quot;</span>))</a>
<a class="sourceLine" id="cb319-16" title="16">  )</a>
<a class="sourceLine" id="cb319-17" title="17">)</a>
<a class="sourceLine" id="cb319-18" title="18"></a>
<a class="sourceLine" id="cb319-19" title="19">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</a>
<a class="sourceLine" id="cb319-20" title="20"></a>
<a class="sourceLine" id="cb319-21" title="21">  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</a>
<a class="sourceLine" id="cb319-22" title="22">    <span class="kw">gio</span>(arcs, <span class="dt">source =</span> i, <span class="dt">target =</span> e, <span class="dt">value =</span> v)</a>
<a class="sourceLine" id="cb319-23" title="23">  })</a>
<a class="sourceLine" id="cb319-24" title="24"></a>
<a class="sourceLine" id="cb319-25" title="25">  output<span class="op">$</span>selectedCountry &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</a>
<a class="sourceLine" id="cb319-26" title="26">    <span class="kw">print</span>(input<span class="op">$</span>globe_selected)</a>
<a class="sourceLine" id="cb319-27" title="27">  })</a>
<a class="sourceLine" id="cb319-28" title="28"></a>
<a class="sourceLine" id="cb319-29" title="29">  output<span class="op">$</span>relatedCountries &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</a>
<a class="sourceLine" id="cb319-30" title="30">    <span class="kw">print</span>(input<span class="op">$</span>globe_related)</a>
<a class="sourceLine" id="cb319-31" title="31">  })</a>
<a class="sourceLine" id="cb319-32" title="32"></a>
<a class="sourceLine" id="cb319-33" title="33">}</a>
<a class="sourceLine" id="cb319-34" title="34"></a>
<a class="sourceLine" id="cb319-35" title="35"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gio-shiny-no-handler"></span>
<img src="images/gio-shiny-input-no-handler.png" alt="Gio with input data" width="100%" />
<p class="caption">
FIGURE 17.1: Gio with input data
</p>
</div>
<p>One thing to note before moving on, the data is sent from the client to the server whether the inputs are used or not, though this likely will not negatively impact gio it can reduce performances if the callback function is triggered too frequently. For instance, an input value set when the user hovers a scatter plot might lead to the event being fired very frequently and too much data being sent to the server, slowing things down and providing a poor experience.</p>
<p>Therefore one might consider making the capture of such event optional, so the web browser is not strained unless explicitly asked by the developer of the application. This could be implemented with a simple function that sets a simple logical variable in the <code>x</code> object that is used in JavaScript to check whether to implement the callback function.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb320-1" title="1"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb320-2" title="2">gio_capture_events &lt;-<span class="st"> </span><span class="cf">function</span>(g) {</a>
<a class="sourceLine" id="cb320-3" title="3">  g<span class="op">$</span>x<span class="op">$</span>capture_events &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb320-4" title="4">  <span class="kw">return</span>(g)</a>
<a class="sourceLine" id="cb320-5" title="5">}</a></code></pre></div>
<p>Then this could be used in JavaScript with an if statement.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb321-1" title="1"><span class="cf">if</span>(<span class="va">x</span>.<span class="at">capture_events</span>)</a>
<a class="sourceLine" id="cb321-2" title="2">  <span class="va">controller</span>.<span class="at">onCountryPicked</span>(callback)<span class="op">;</span></a></code></pre></div>
<p>One might also consider not sending back all the data. For instance, gio returns the coordinates of the selected country wherefrom arcs connect; this might be considered unnecessary. The code below only sets the input to the ISO code of the country selected.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb322-1" title="1"><span class="kw">function</span> <span class="at">callback</span> (selectedCountry<span class="op">,</span> relatedCountries) <span class="op">{</span></a>
<a class="sourceLine" id="cb322-2" title="2">  <span class="va">Shiny</span>.<span class="at">setInputValue</span>(</a>
<a class="sourceLine" id="cb322-3" title="3">    <span class="va">el</span>.<span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_selected&#39;</span><span class="op">,</span> </a>
<a class="sourceLine" id="cb322-4" title="4">    <span class="va">selectedCountry</span>.<span class="at">ISOCode</span></a>
<a class="sourceLine" id="cb322-5" title="5">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb322-6" title="6"><span class="op">}</span></a></code></pre></div>
</div>
<div id="shiny-widgets-handlers" class="section level2">
<h2><span class="header-section-number">17.2</span> Input Handlers for Widgets</h2>
<p>Input handlers were explored in an earlier chapter where it was used to transform the results of an image classification model from a list to a data.frame. We can apply something very similar to this input data; the “related countries” returned consist of edges and should be reshaped into a data.frame as well (that looks like <code>gio</code>’s input data).</p>
<p>Below we create a handler that is going to loop over the list (over each arc) and return a data frame.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb323-1" title="1"><span class="co"># handler.R</span></a>
<a class="sourceLine" id="cb323-2" title="2">related_countries_handler &lt;-<span class="st"> </span><span class="cf">function</span>(x, session, inputname){</a>
<a class="sourceLine" id="cb323-3" title="3">  purrr<span class="op">::</span><span class="kw">map_dfr</span>(x, as.data.frame)</a>
<a class="sourceLine" id="cb323-4" title="4">}</a></code></pre></div>
<p>Then the handler must be registered with Shiny since handlers can only be registered once an excellent place to put it this is in the <code>.onLoad</code> function of the package.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb324-1" title="1"><span class="co"># zzz.R</span></a>
<a class="sourceLine" id="cb324-2" title="2">related_countries_handler &lt;-<span class="st"> </span><span class="cf">function</span>(x, session, inputname){</a>
<a class="sourceLine" id="cb324-3" title="3">  purrr<span class="op">::</span><span class="kw">map_dfr</span>(x, as.data.frame)</a>
<a class="sourceLine" id="cb324-4" title="4">}</a>
<a class="sourceLine" id="cb324-5" title="5"></a>
<a class="sourceLine" id="cb324-6" title="6">.onLoad &lt;-<span class="st"> </span><span class="cf">function</span>(libname, pkgname) {</a>
<a class="sourceLine" id="cb324-7" title="7">  shiny<span class="op">::</span><span class="kw">registerInputHandler</span>(</a>
<a class="sourceLine" id="cb324-8" title="8">    <span class="st">&quot;gio.related.countries&quot;</span>, </a>
<a class="sourceLine" id="cb324-9" title="9">    related_countries_handler</a>
<a class="sourceLine" id="cb324-10" title="10">  )</a>
<a class="sourceLine" id="cb324-11" title="11">}</a></code></pre></div>
<p>Finally, we can reinstall the package with <code>devtools::install</code> and create a Shiny application to observe the change. Below we use a large example dataset and, since the input now returns a data frame, we can display the input value in a table.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb325-1" title="1"><span class="kw">library</span>(DT)</a>
<a class="sourceLine" id="cb325-2" title="2"><span class="kw">library</span>(gio)</a>
<a class="sourceLine" id="cb325-3" title="3"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb325-4" title="4"></a>
<a class="sourceLine" id="cb325-5" title="5"><span class="co"># large sample data</span></a>
<a class="sourceLine" id="cb325-6" title="6">url &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb325-7" title="7">  <span class="st">&quot;https://raw.githubusercontent.com/JohnCoene/&quot;</span>,</a>
<a class="sourceLine" id="cb325-8" title="8">  <span class="st">&quot;javascript-for-r/master/data/countries.json&quot;</span></a>
<a class="sourceLine" id="cb325-9" title="9">)</a>
<a class="sourceLine" id="cb325-10" title="10">arcs &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw">fromJSON</span>(url)</a>
<a class="sourceLine" id="cb325-11" title="11"></a>
<a class="sourceLine" id="cb325-12" title="12">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb325-13" title="13">  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>),</a>
<a class="sourceLine" id="cb325-14" title="14">  <span class="kw">DTOutput</span>(<span class="st">&quot;relatedCountries&quot;</span>)</a>
<a class="sourceLine" id="cb325-15" title="15">)</a>
<a class="sourceLine" id="cb325-16" title="16"></a>
<a class="sourceLine" id="cb325-17" title="17">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</a>
<a class="sourceLine" id="cb325-18" title="18"></a>
<a class="sourceLine" id="cb325-19" title="19">  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</a>
<a class="sourceLine" id="cb325-20" title="20">    <span class="kw">gio</span>(arcs, i, e, v)</a>
<a class="sourceLine" id="cb325-21" title="21">  })</a>
<a class="sourceLine" id="cb325-22" title="22"></a>
<a class="sourceLine" id="cb325-23" title="23">  output<span class="op">$</span>relatedCountries &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</a>
<a class="sourceLine" id="cb325-24" title="24">    <span class="kw">datatable</span>(input<span class="op">$</span>globe_related)</a>
<a class="sourceLine" id="cb325-25" title="25">  })</a>
<a class="sourceLine" id="cb325-26" title="26"></a>
<a class="sourceLine" id="cb325-27" title="27">}</a>
<a class="sourceLine" id="cb325-28" title="28"></a>
<a class="sourceLine" id="cb325-29" title="29"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gio-input-handler"></span>
<img src="images/gio-input-handler.png" alt="Gio input data transformed to a data frame" width="100%" />
<p class="caption">
FIGURE 17.2: Gio input data transformed to a data frame
</p>
</div>
</div>
<div id="shiny-widgets-r-to-widgets" class="section level2">
<h2><span class="header-section-number">17.3</span> R to Widgets</h2>
<p>This book previously explored how to send data from the Shiny server to the front end; this section applies this to htmlwidgets. Currently, using gio in Shiny consists of generating the globe with the <code>renderGio</code> and complimentary <code>gioOutput</code> functions. This generates the complete visualisation, it creates the  element where it places the globe, draws the arcs based on the data, sets the style, etc.</p>
<p>Now imagine that only one of those aspects needs changing, say the data, or the style, given the functions currently at hand one would have to redraw the entire visualisation, only this time changing the data or the style. This is inelegant and not efficient, most JavaScript visualisation libraries, including gio.js, will enable changing only certain aspects of the output without having to redraw it all from scratch.</p>
<p>Before we look into the implementation, let us create a Shiny application which would benefit from such a feature. The Shiny application below provides a drop-down menu to select between two datasets to draw on the globe, running it reveals an issue with gio though. Upon selecting a dataset with the drop down a second globe appears underneath the original one. This is because internally gio.js creates a new element (<code>&lt;canvas&gt;</code>) within the <code>&lt;div&gt;</code> created by <code>htmlwidgets</code> when running <code>init</code> regardless of whether one was already created. Therefore, every call to <code>init</code> creates a new <code>&lt;canvas&gt;</code> with a different globe. Note that most visualisation libraries <em>will not have that issue</em>, they will detect the existing output and override it instead.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb326-1" title="1"><span class="kw">library</span>(gio)</a>
<a class="sourceLine" id="cb326-2" title="2"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb326-3" title="3"></a>
<a class="sourceLine" id="cb326-4" title="4">arcs1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb326-5" title="5">  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>),</a>
<a class="sourceLine" id="cb326-6" title="6">  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>, <span class="st">&quot;US&quot;</span>),</a>
<a class="sourceLine" id="cb326-7" title="7">  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</a>
<a class="sourceLine" id="cb326-8" title="8">)</a>
<a class="sourceLine" id="cb326-9" title="9"></a>
<a class="sourceLine" id="cb326-10" title="10">arcs2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb326-11" title="11">  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;JP&quot;</span>),</a>
<a class="sourceLine" id="cb326-12" title="12">  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;IN&quot;</span>, <span class="st">&quot;JP&quot;</span>, <span class="st">&quot;US&quot;</span>),</a>
<a class="sourceLine" id="cb326-13" title="13">  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</a>
<a class="sourceLine" id="cb326-14" title="14">)</a>
<a class="sourceLine" id="cb326-15" title="15"></a>
<a class="sourceLine" id="cb326-16" title="16">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb326-17" title="17">  <span class="kw">selectInput</span>(</a>
<a class="sourceLine" id="cb326-18" title="18">    <span class="st">&quot;dataset&quot;</span>, </a>
<a class="sourceLine" id="cb326-19" title="19">    <span class="st">&quot;Select a dataset&quot;</span>, </a>
<a class="sourceLine" id="cb326-20" title="20">    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;First&quot;</span>, <span class="st">&quot;Second&quot;</span>)</a>
<a class="sourceLine" id="cb326-21" title="21">  ),</a>
<a class="sourceLine" id="cb326-22" title="22">  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>)</a>
<a class="sourceLine" id="cb326-23" title="23">)</a>
<a class="sourceLine" id="cb326-24" title="24"></a>
<a class="sourceLine" id="cb326-25" title="25">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</a>
<a class="sourceLine" id="cb326-26" title="26"></a>
<a class="sourceLine" id="cb326-27" title="27">  reactive_arcs &lt;-<span class="st"> </span><span class="kw">reactive</span>({</a>
<a class="sourceLine" id="cb326-28" title="28">    <span class="cf">if</span>(input<span class="op">$</span>dataset <span class="op">==</span><span class="st"> &quot;First&quot;</span>) </a>
<a class="sourceLine" id="cb326-29" title="29">      <span class="kw">return</span>(arcs1)</a>
<a class="sourceLine" id="cb326-30" title="30">    <span class="kw">return</span>(arcs2)</a>
<a class="sourceLine" id="cb326-31" title="31">  })</a>
<a class="sourceLine" id="cb326-32" title="32"></a>
<a class="sourceLine" id="cb326-33" title="33">  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</a>
<a class="sourceLine" id="cb326-34" title="34">    <span class="kw">gio</span>(<span class="kw">reactive_arcs</span>(), i, e, v)</a>
<a class="sourceLine" id="cb326-35" title="35">  })</a>
<a class="sourceLine" id="cb326-36" title="36"></a>
<a class="sourceLine" id="cb326-37" title="37">}</a>
<a class="sourceLine" id="cb326-38" title="38"></a>
<a class="sourceLine" id="cb326-39" title="39"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gio-shiny-error"></span>
<img src="images/gio-shiny-error.png" alt="Gio issue in shiny" width="100%" />
<p class="caption">
FIGURE 17.3: Gio issue in shiny
</p>
</div>
<p>A solution to this is to ensure the container (<code>el</code>) is empty before generating the visualisation. Incidentally, this can be executed with a JavaScript method previously used in this book: <code>innerHTML</code>.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb327-1" title="1"><span class="co">// gio.js</span></a>
<a class="sourceLine" id="cb327-2" title="2"><span class="va">el</span>.<span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span> <span class="co">// empty el</span></a>
<a class="sourceLine" id="cb327-3" title="3">controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(el)<span class="op">;</span></a></code></pre></div>
<p>Now, using the dropdown to switch between dataset does not generate a new visualisation.</p>
<p>We got sidetracked, but this had to be fixed. Ideally, when the user selects a dataset from the dropdown the entire  is not redrawn, only the underlying data (the arcs) changes. To do so, a new set of functions divorced from the ones currently at hand needs to be created. This separation will allow leaving the already created functions as-is, using <code>gio</code> and its corresponding <code>renderValue</code> JavaScript function to initialise a visualisation, and have a separate family of functions dedicated to working with different JavaScript functions which circumvent <code>renderValue</code> and directly change aspects of the visualisation, such as the underlying dataset.</p>
<p>This involves a few moving parts, thankfully some of them were already explored, just not in the context of htmlwidgets. The scheme is to send data from R to JavaScript using the formerly exploited <code>session$sendCustomMessage</code>, then in JavaScript fetch the instance of the visualisation (<code>controller</code> in the case of gio) to interact with it (<code>e.g. controller.addData(data);</code>).</p>
<div id="shiny-widgets-send-data" class="section level3">
<h3><span class="header-section-number">17.3.1</span> Send Data from Widgets</h3>
<p>Let us start by creating the R function used to send data to JavaScript. This is hopefully reminiscent of a previous chapter; this function sends a message to JavaScript where it is paired with “message handler” that does something with said message. Note that for consistency the function uses the same arguments as the other function of the package which accepts data: <code>gio</code>.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb328-1" title="1"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb328-2" title="2">gio_send_data &lt;-<span class="st"> </span><span class="cf">function</span>(id, data, source, target, value, </a>
<a class="sourceLine" id="cb328-3" title="3">  <span class="dt">session =</span> shiny<span class="op">::</span><span class="kw">getDefaultReactiveDomain</span>()){</a>
<a class="sourceLine" id="cb328-4" title="4"></a>
<a class="sourceLine" id="cb328-5" title="5">  data &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb328-6" title="6">    data,</a>
<a class="sourceLine" id="cb328-7" title="7">    <span class="dt">i =</span> {{ source }},</a>
<a class="sourceLine" id="cb328-8" title="8">    <span class="dt">e =</span> {{ target }},</a>
<a class="sourceLine" id="cb328-9" title="9">    <span class="dt">v =</span> {{ value }}</a>
<a class="sourceLine" id="cb328-10" title="10">  )</a>
<a class="sourceLine" id="cb328-11" title="11">  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> id, <span class="dt">data =</span> data)</a>
<a class="sourceLine" id="cb328-12" title="12">  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;send-data&quot;</span>, message)</a>
<a class="sourceLine" id="cb328-13" title="13">}</a></code></pre></div>
<p>The function takes the id of the visualisation the data is destined for, the data object itself, and a Shiny session used to send the data. The id of the visualisation is sent as part of the message and will be used to retrieve the instance of the visualisation and subsequently apply the new dataset. Note that we give this message the <code>send-data</code> identifier, this will be needed when we write its handler.</p>
<p>There is one caveat that will make it such that the above will not work. To have gio.js work with data changes had to be made to the serialiser (using the <code>TOJSON_ARGS</code> attribute), this cannot be used here. The data being sent with Shiny via the session object the problem reoccurs: Shiny, like htmlwidgets, serialises data frames column-wise and not row-wise. One can preview the way Shiny serialises with <code>shiny:::toJSON</code> (three-colon).</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb329-1" title="1"><span class="co"># preview shiny serialisation</span></a>
<a class="sourceLine" id="cb329-2" title="2">shiny<span class="op">:::</span><span class="kw">toJSON</span>(arcs)</a>
<a class="sourceLine" id="cb329-3" title="3"><span class="co">#&gt; {&quot;e&quot;:[&quot;CN&quot;,&quot;CN&quot;],&quot;i&quot;:[&quot;US&quot;,&quot;RU&quot;],&quot;v&quot;:[3300000,10000]}</span></a></code></pre></div>
<p>Unfortunately this serialiser cannot be changed, therefore we have to reformat the data to a list which resembles the  output desired, using <code>apply</code> to turn every row into a list will do the job in most cases.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb330-1" title="1"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb330-2" title="2">gio_send_data &lt;-<span class="st"> </span><span class="cf">function</span>(id, data, source, target, value, </a>
<a class="sourceLine" id="cb330-3" title="3">  <span class="dt">session =</span> shiny<span class="op">::</span><span class="kw">getDefaultReactiveDomain</span>()){</a>
<a class="sourceLine" id="cb330-4" title="4"></a>
<a class="sourceLine" id="cb330-5" title="5">  data &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb330-6" title="6">    data,</a>
<a class="sourceLine" id="cb330-7" title="7">    <span class="dt">i =</span> {{ source }},</a>
<a class="sourceLine" id="cb330-8" title="8">    <span class="dt">e =</span> {{ target }},</a>
<a class="sourceLine" id="cb330-9" title="9">    <span class="dt">v =</span> {{ value }}</a>
<a class="sourceLine" id="cb330-10" title="10">  )</a>
<a class="sourceLine" id="cb330-11" title="11">  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> id, <span class="dt">data =</span> <span class="kw">apply</span>(data, <span class="dv">1</span>, as.list))</a>
<a class="sourceLine" id="cb330-12" title="12">  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;send-data&quot;</span>, message)</a>
<a class="sourceLine" id="cb330-13" title="13">}</a></code></pre></div>
</div>
<div id="shiny-widgets-retrieve" class="section level3">
<h3><span class="header-section-number">17.3.2</span> Retrieve Widget Instance</h3>
<p>We will need to be able to access the instance of the visualisation (<code>controller</code>) outside of the function <code>factory</code>. This can be made accessible by adding a function (technically a method) that returns the <code>controller</code>. Below we create a function called <code>getGlobe</code> which returns the <code>controller</code>.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb331-1" title="1"><span class="va">HTMLWidgets</span>.<span class="at">widget</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb331-2" title="2"></a>
<a class="sourceLine" id="cb331-3" title="3">  <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;gio&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb331-4" title="4"></a>
<a class="sourceLine" id="cb331-5" title="5">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;output&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb331-6" title="6"></a>
<a class="sourceLine" id="cb331-7" title="7">  <span class="dt">factory</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> width<span class="op">,</span> height) <span class="op">{</span></a>
<a class="sourceLine" id="cb331-8" title="8"></a>
<a class="sourceLine" id="cb331-9" title="9">    <span class="co">// </span><span class="al">TODO</span><span class="co">: define shared variables for this instance</span></a>
<a class="sourceLine" id="cb331-10" title="10">    <span class="kw">var</span> controller<span class="op">;</span></a>
<a class="sourceLine" id="cb331-11" title="11"></a>
<a class="sourceLine" id="cb331-12" title="12">    <span class="co">// selection handle</span></a>
<a class="sourceLine" id="cb331-13" title="13">    <span class="kw">var</span> sel_handle <span class="op">=</span> <span class="kw">new</span> <span class="va">crosstalk</span>.<span class="at">SelectionHandle</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb331-14" title="14"></a>
<a class="sourceLine" id="cb331-15" title="15">    <span class="va">sel_handle</span>.<span class="at">on</span>(<span class="st">&quot;change&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb331-16" title="16">      <span class="cf">if</span> (<span class="va">e</span>.<span class="at">sender</span> <span class="op">!==</span> sel_handle) <span class="op">{</span></a>
<a class="sourceLine" id="cb331-17" title="17">        <span class="co">// clear selection</span></a>
<a class="sourceLine" id="cb331-18" title="18">      <span class="op">}</span></a>
<a class="sourceLine" id="cb331-19" title="19">      <span class="va">controller</span>.<span class="at">switchCountry</span>(<span class="va">e</span>.<span class="at">value</span>[<span class="dv">0</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb331-20" title="20">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb331-21" title="21"></a>
<a class="sourceLine" id="cb331-22" title="22"></a>
<a class="sourceLine" id="cb331-23" title="23">    <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb331-24" title="24"></a>
<a class="sourceLine" id="cb331-25" title="25">      <span class="dt">renderValue</span><span class="op">:</span> <span class="kw">function</span>(x) <span class="op">{</span></a>
<a class="sourceLine" id="cb331-26" title="26"></a>
<a class="sourceLine" id="cb331-27" title="27">        <span class="va">el</span>.<span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb331-28" title="28">        controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(el<span class="op">,</span> <span class="va">x</span>.<span class="at">configs</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb331-29" title="29"></a>
<a class="sourceLine" id="cb331-30" title="30">        <span class="co">// group</span></a>
<a class="sourceLine" id="cb331-31" title="31">        <span class="va">sel_handle</span>.<span class="at">setGroup</span>(<span class="va">x</span>.<span class="va">crosstalk</span>.<span class="at">group</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb331-32" title="32">        </a>
<a class="sourceLine" id="cb331-33" title="33">        <span class="co">// add data</span></a>
<a class="sourceLine" id="cb331-34" title="34">        <span class="va">controller</span>.<span class="at">addData</span>(<span class="va">x</span>.<span class="at">data</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb331-35" title="35"></a>
<a class="sourceLine" id="cb331-36" title="36">        <span class="va">controller</span>.<span class="at">setStyle</span>(<span class="va">x</span>.<span class="at">style</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb331-37" title="37"></a>
<a class="sourceLine" id="cb331-38" title="38">        <span class="co">// callback</span></a>
<a class="sourceLine" id="cb331-39" title="39">        <span class="va">controller</span>.<span class="at">onCountryPicked</span>(callback)<span class="op">;</span></a>
<a class="sourceLine" id="cb331-40" title="40"></a>
<a class="sourceLine" id="cb331-41" title="41">        <span class="kw">function</span> <span class="at">callback</span> (selectedCountry<span class="op">,</span> relatedCountries) <span class="op">{</span></a>
<a class="sourceLine" id="cb331-42" title="42">          <span class="va">sel_handle</span>.<span class="at">set</span>([<span class="va">selectedCountry</span>.<span class="at">ISOCode</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb331-43" title="43">          <span class="va">Shiny</span>.<span class="at">setInputValue</span>(</a>
<a class="sourceLine" id="cb331-44" title="44">            <span class="va">el</span>.<span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_selected&#39;</span><span class="op">,</span> </a>
<a class="sourceLine" id="cb331-45" title="45">            selectedCountry</a>
<a class="sourceLine" id="cb331-46" title="46">          )<span class="op">;</span></a>
<a class="sourceLine" id="cb331-47" title="47">          <span class="va">Shiny</span>.<span class="at">setInputValue</span>(</a>
<a class="sourceLine" id="cb331-48" title="48">            <span class="va">el</span>.<span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_related:gio.related.countries&#39;</span><span class="op">,</span> </a>
<a class="sourceLine" id="cb331-49" title="49">            relatedCountries</a>
<a class="sourceLine" id="cb331-50" title="50">          )<span class="op">;</span></a>
<a class="sourceLine" id="cb331-51" title="51">        <span class="op">}</span></a>
<a class="sourceLine" id="cb331-52" title="52"></a>
<a class="sourceLine" id="cb331-53" title="53">        <span class="co">// use stats</span></a>
<a class="sourceLine" id="cb331-54" title="54">        <span class="cf">if</span>(<span class="va">x</span>.<span class="at">stats</span>)</a>
<a class="sourceLine" id="cb331-55" title="55">          <span class="va">controller</span>.<span class="at">enableStats</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb331-56" title="56"></a>
<a class="sourceLine" id="cb331-57" title="57">        <span class="co">// render</span></a>
<a class="sourceLine" id="cb331-58" title="58">        <span class="va">controller</span>.<span class="at">init</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb331-59" title="59"></a>
<a class="sourceLine" id="cb331-60" title="60">      <span class="op">},</span></a>
<a class="sourceLine" id="cb331-61" title="61"></a>
<a class="sourceLine" id="cb331-62" title="62">      <span class="dt">resize</span><span class="op">:</span> <span class="kw">function</span>(width<span class="op">,</span> height) <span class="op">{</span></a>
<a class="sourceLine" id="cb331-63" title="63"></a>
<a class="sourceLine" id="cb331-64" title="64">        <span class="co">// </span><span class="al">TODO</span><span class="co">: code to re-render the widget with a new size</span></a>
<a class="sourceLine" id="cb331-65" title="65">        <span class="va">controller</span>.<span class="at">resizeUpdate</span>()</a>
<a class="sourceLine" id="cb331-66" title="66"></a>
<a class="sourceLine" id="cb331-67" title="67">      <span class="op">},</span></a>
<a class="sourceLine" id="cb331-68" title="68"></a>
<a class="sourceLine" id="cb331-69" title="69">      <span class="dt">getGlobe</span><span class="op">:</span> <span class="kw">function</span>()<span class="op">{</span></a>
<a class="sourceLine" id="cb331-70" title="70">        <span class="cf">return</span> controller<span class="op">;</span></a>
<a class="sourceLine" id="cb331-71" title="71">      <span class="op">}</span></a>
<a class="sourceLine" id="cb331-72" title="72"></a>
<a class="sourceLine" id="cb331-73" title="73">    <span class="op">};</span></a>
<a class="sourceLine" id="cb331-74" title="74">  <span class="op">}</span></a>
<a class="sourceLine" id="cb331-75" title="75"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Then, anywhere in the <code>gio.js</code> file, we create a function that uses <code>HTMLWidgets.find</code> to retrieve the instance of the htmlwidgets it takes a selector as input. We concatenate the pound sign to select the widget based on its id (<code>#id</code>, <code>.class</code>). This, in effect, returns an object, which includes all the functions returned by the <code>factory</code> function: <code>renderValue</code>, <code>resize</code>, and <code>getGlobe</code>. We can therefore use the <code>getGlobe</code> method available from that object to retrieve the actual <code>controller</code>.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb332-1" title="1"><span class="co">// gio.js</span></a>
<a class="sourceLine" id="cb332-2" title="2"><span class="kw">function</span> <span class="at">get_gio</span>(id)<span class="op">{</span></a>
<a class="sourceLine" id="cb332-3" title="3">  <span class="kw">var</span> widget <span class="op">=</span> <span class="va">HTMLWidgets</span>.<span class="at">find</span>(<span class="st">&quot;#&quot;</span> <span class="op">+</span> id)<span class="op">;</span></a>
<a class="sourceLine" id="cb332-4" title="4">  <span class="kw">var</span> globe <span class="op">=</span> <span class="va">widget</span>.<span class="at">getGlobe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb332-5" title="5">  <span class="cf">return</span> globe<span class="op">;</span></a>
<a class="sourceLine" id="cb332-6" title="6"><span class="op">}</span></a></code></pre></div>
</div>
<div id="shiny-widgets-handle-data" class="section level3">
<h3><span class="header-section-number">17.3.3</span> Handle Data</h3>
<p>We can now turn our attention to actually applying the data sent from the R server to the visualisation: the “message handler.” Registering the message handler is only relevant if Shiny is running. Therefore htmlwidgets comes with a function to check whether that is the case, which is useful to avoid needless errors. We can thus use it in an if-statement in which all message handlers will be registered.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb333-1" title="1"><span class="co">// gio.js</span></a>
<a class="sourceLine" id="cb333-2" title="2"></a>
<a class="sourceLine" id="cb333-3" title="3"><span class="co">// check if shiny running</span></a>
<a class="sourceLine" id="cb333-4" title="4"><span class="cf">if</span> (<span class="va">HTMLWidgets</span>.<span class="at">shinyMode</span>)<span class="op">{</span></a>
<a class="sourceLine" id="cb333-5" title="5"></a>
<a class="sourceLine" id="cb333-6" title="6">  <span class="co">// send-data message handler</span></a>
<a class="sourceLine" id="cb333-7" title="7">  <span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(</a>
<a class="sourceLine" id="cb333-8" title="8">    type <span class="op">=</span> <span class="st">&#39;send-data&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></a>
<a class="sourceLine" id="cb333-9" title="9"></a>
<a class="sourceLine" id="cb333-10" title="10">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb333-11" title="11"></a>
<a class="sourceLine" id="cb333-12" title="12"><span class="op">}</span></a></code></pre></div>
<p>What the currently empty <code>send-data</code> message handler should do is fetch the widget using the <code>id</code> sent from R with the <code>get_gio</code> function and then use the <code>addData</code> method to override the previously-defined arcs.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb334-1" title="1"><span class="co">// gio.js</span></a>
<a class="sourceLine" id="cb334-2" title="2"></a>
<a class="sourceLine" id="cb334-3" title="3"><span class="co">// check if shiny running</span></a>
<a class="sourceLine" id="cb334-4" title="4"><span class="cf">if</span> (<span class="va">HTMLWidgets</span>.<span class="at">shinyMode</span>)<span class="op">{</span></a>
<a class="sourceLine" id="cb334-5" title="5"></a>
<a class="sourceLine" id="cb334-6" title="6">  <span class="co">// send-data message handler</span></a>
<a class="sourceLine" id="cb334-7" title="7">  <span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(</a>
<a class="sourceLine" id="cb334-8" title="8">    type <span class="op">=</span> <span class="st">&#39;send-data&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></a>
<a class="sourceLine" id="cb334-9" title="9"></a>
<a class="sourceLine" id="cb334-10" title="10">    <span class="co">// retrieve controller</span></a>
<a class="sourceLine" id="cb334-11" title="11">    <span class="kw">var</span> controller <span class="op">=</span> <span class="at">get_gio</span>(<span class="va">message</span>.<span class="at">id</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb334-12" title="12"></a>
<a class="sourceLine" id="cb334-13" title="13">    <span class="co">// add data</span></a>
<a class="sourceLine" id="cb334-14" title="14">    <span class="va">controller</span>.<span class="at">addData</span>(<span class="va">message</span>.<span class="at">data</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb334-15" title="15"></a>
<a class="sourceLine" id="cb334-16" title="16">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb334-17" title="17"></a>
<a class="sourceLine" id="cb334-18" title="18"><span class="op">}</span></a></code></pre></div>
<p>We can then build a Shiny application to test the new functionality.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb335-1" title="1"><span class="kw">library</span>(gio)</a>
<a class="sourceLine" id="cb335-2" title="2"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb335-3" title="3"></a>
<a class="sourceLine" id="cb335-4" title="4"><span class="co"># two phoney datasets</span></a>
<a class="sourceLine" id="cb335-5" title="5">arcs1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb335-6" title="6">  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>),</a>
<a class="sourceLine" id="cb335-7" title="7">  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>, <span class="st">&quot;US&quot;</span>),</a>
<a class="sourceLine" id="cb335-8" title="8">  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</a>
<a class="sourceLine" id="cb335-9" title="9">)</a>
<a class="sourceLine" id="cb335-10" title="10"></a>
<a class="sourceLine" id="cb335-11" title="11">arcs2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb335-12" title="12">  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;JP&quot;</span>),</a>
<a class="sourceLine" id="cb335-13" title="13">  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;IN&quot;</span>, <span class="st">&quot;JP&quot;</span>, <span class="st">&quot;US&quot;</span>),</a>
<a class="sourceLine" id="cb335-14" title="14">  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</a>
<a class="sourceLine" id="cb335-15" title="15">)</a>
<a class="sourceLine" id="cb335-16" title="16"></a>
<a class="sourceLine" id="cb335-17" title="17">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb335-18" title="18">  <span class="kw">selectInput</span>(</a>
<a class="sourceLine" id="cb335-19" title="19">    <span class="st">&quot;dataset&quot;</span>, </a>
<a class="sourceLine" id="cb335-20" title="20">    <span class="st">&quot;Select a dataset&quot;</span>, </a>
<a class="sourceLine" id="cb335-21" title="21">    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;First&quot;</span>, <span class="st">&quot;Second&quot;</span>)</a>
<a class="sourceLine" id="cb335-22" title="22">  ),</a>
<a class="sourceLine" id="cb335-23" title="23">  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>)</a>
<a class="sourceLine" id="cb335-24" title="24">)</a>
<a class="sourceLine" id="cb335-25" title="25"></a>
<a class="sourceLine" id="cb335-26" title="26">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</a>
<a class="sourceLine" id="cb335-27" title="27"></a>
<a class="sourceLine" id="cb335-28" title="28">  reactive_arcs &lt;-<span class="st"> </span><span class="kw">reactive</span>({</a>
<a class="sourceLine" id="cb335-29" title="29">    <span class="cf">if</span>(input<span class="op">$</span>dataset <span class="op">==</span><span class="st"> &quot;First&quot;</span>) </a>
<a class="sourceLine" id="cb335-30" title="30">      <span class="kw">return</span>(arcs1)</a>
<a class="sourceLine" id="cb335-31" title="31">    <span class="kw">return</span>(arcs2)</a>
<a class="sourceLine" id="cb335-32" title="32">  })</a>
<a class="sourceLine" id="cb335-33" title="33"></a>
<a class="sourceLine" id="cb335-34" title="34">  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</a>
<a class="sourceLine" id="cb335-35" title="35">    <span class="kw">gio</span>(arcs1, i, e, v)</a>
<a class="sourceLine" id="cb335-36" title="36">  })</a>
<a class="sourceLine" id="cb335-37" title="37"></a>
<a class="sourceLine" id="cb335-38" title="38">  <span class="kw">observeEvent</span>(input<span class="op">$</span>dataset, {</a>
<a class="sourceLine" id="cb335-39" title="39">    <span class="cf">if</span>(input<span class="op">$</span>dataset <span class="op">==</span><span class="st"> &quot;First&quot;</span>)</a>
<a class="sourceLine" id="cb335-40" title="40">      data &lt;-<span class="st"> </span>arcs1</a>
<a class="sourceLine" id="cb335-41" title="41">    <span class="cf">else</span></a>
<a class="sourceLine" id="cb335-42" title="42">      data &lt;-<span class="st"> </span>arcs2</a>
<a class="sourceLine" id="cb335-43" title="43">    </a>
<a class="sourceLine" id="cb335-44" title="44">    <span class="kw">gio_send_data</span>(<span class="st">&quot;globe&quot;</span>, data, i, e, v)</a>
<a class="sourceLine" id="cb335-45" title="45">  })</a>
<a class="sourceLine" id="cb335-46" title="46"></a>
<a class="sourceLine" id="cb335-47" title="47">}</a>
<a class="sourceLine" id="cb335-48" title="48"></a>
<a class="sourceLine" id="cb335-49" title="49"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>Switching dataset with the dropdown only changes the data; it makes for a much smoother animation, even the difference in the speed at which the effect is visible on the visualisation is perceivable.</p>
</div>
</div>
<div id="shiny-widgets-proxy" class="section level2">
<h2><span class="header-section-number">17.4</span> Proxy Function</h2>
<p>Before we add other similar functions, we ought to pause and consider the API this provides the user. There are two points, every function such as <code>gio_send_data</code>, will need to accept the <code>id</code> and <code>session</code> arguments. It will be tedious to so every time, following the old “don’t repeat yourself” adage we ought to abstract this further.</p>
<p>This can be remedied to by introducing what is often referred to as a “proxy.” A proxy is just a representation of the graph, or pragmatically, an object that contains the id of the  and a Shiny session. This object can subsequently be piped to other functions, thereby providing not only a cleaner but also a more consistent API.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb336-1" title="1"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb336-2" title="2">gio_proxy &lt;-<span class="st"> </span><span class="cf">function</span>(id, </a>
<a class="sourceLine" id="cb336-3" title="3">  <span class="dt">session =</span> shiny<span class="op">::</span><span class="kw">getDefaultReactiveDomain</span>()</a>
<a class="sourceLine" id="cb336-4" title="4">){</a>
<a class="sourceLine" id="cb336-5" title="5"></a>
<a class="sourceLine" id="cb336-6" title="6">  <span class="kw">list</span>(<span class="dt">id =</span> id, <span class="dt">session =</span> session)</a>
<a class="sourceLine" id="cb336-7" title="7">}</a></code></pre></div>
<p>Above we create a function called <code>gio_proxy</code>; it takes the <code>id</code> of the chart one wants to build a proxy for, as well as the Shiny <code>session</code>, these are returned in the form of a list. Next, we should adapt the <code>gio_send_data</code> so that it accepts the output of <code>gioProxy</code> instead of the <code>id</code> and <code>session</code> as done previously. In order to allow chaining such functions, we also make sure it returns the <code>proxy</code> object.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb337-1" title="1"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb337-2" title="2">gio_send_data &lt;-<span class="st"> </span><span class="cf">function</span>(proxy, data){</a>
<a class="sourceLine" id="cb337-3" title="3">  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> proxy<span class="op">$</span>id, <span class="dt">data =</span> <span class="kw">apply</span>(data, <span class="dv">1</span>, as.list))</a>
<a class="sourceLine" id="cb337-4" title="4">  proxy<span class="op">$</span>session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;send-data&quot;</span>, message)</a>
<a class="sourceLine" id="cb337-5" title="5">  <span class="kw">return</span>(proxy)</a>
<a class="sourceLine" id="cb337-6" title="6">}</a></code></pre></div>
</div>
<div id="shiny-widgets-clear-data" class="section level2">
<h2><span class="header-section-number">17.5</span> Clear Data</h2>
<p>In order to actively demonstrate the advantage of the “proxy” function as well as to hammer home how such functions work, we shall build another, which removes all data from the globe. In JavaScript, it’s as simple as <code>controller.clearData();</code>.</p>
<p>The journey starts with the R code, where we create a new function that sends a message to clear the data; the message only needs to contain the id of the visualisation from which data needs to be cleared, as before it will be used to retrieve the <code>controller</code> from which the <code>clearData</code> method is available.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" title="1"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb338-2" title="2">gio_clear_data &lt;-<span class="st"> </span><span class="cf">function</span>(proxy){</a>
<a class="sourceLine" id="cb338-3" title="3">  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> proxy<span class="op">$</span>id)</a>
<a class="sourceLine" id="cb338-4" title="4">  proxy<span class="op">$</span>session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;clear-data&quot;</span>, message)</a>
<a class="sourceLine" id="cb338-5" title="5">  <span class="kw">return</span>(proxy)</a>
<a class="sourceLine" id="cb338-6" title="6">}</a></code></pre></div>
<p>Now onto the JavaScript code to catch that message and actually clear the data from the globe. That function is very similar to what was previously shown, the only difference is the name of the message handler and the method used on the controller.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb339-1" title="1"><span class="co">// gio.js</span></a>
<a class="sourceLine" id="cb339-2" title="2"><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(</a>
<a class="sourceLine" id="cb339-3" title="3">  type <span class="op">=</span> <span class="st">&#39;clear-data&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></a>
<a class="sourceLine" id="cb339-4" title="4"></a>
<a class="sourceLine" id="cb339-5" title="5">    <span class="kw">var</span> controller <span class="op">=</span> <span class="at">get_gio</span>(<span class="va">message</span>.<span class="at">id</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb339-6" title="6">    <span class="va">controller</span>.<span class="at">clearData</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb339-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Then one can build an application to test that new function. We build a Shiny application with a button to add the data to the visualisation and another to clear data from it.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" title="1"><span class="kw">library</span>(gio)</a>
<a class="sourceLine" id="cb340-2" title="2"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb340-3" title="3"></a>
<a class="sourceLine" id="cb340-4" title="4"><span class="co"># phoney dataset</span></a>
<a class="sourceLine" id="cb340-5" title="5">arcs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb340-6" title="6">  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>),</a>
<a class="sourceLine" id="cb340-7" title="7">  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>, <span class="st">&quot;US&quot;</span>),</a>
<a class="sourceLine" id="cb340-8" title="8">  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</a>
<a class="sourceLine" id="cb340-9" title="9">)</a>
<a class="sourceLine" id="cb340-10" title="10"></a>
<a class="sourceLine" id="cb340-11" title="11">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb340-12" title="12">  <span class="kw">actionButton</span>(<span class="st">&quot;load&quot;</span>, <span class="st">&quot;Load data&quot;</span>),</a>
<a class="sourceLine" id="cb340-13" title="13">  <span class="kw">actionButton</span>(<span class="st">&quot;clear&quot;</span>, <span class="st">&quot;Clear data&quot;</span>),</a>
<a class="sourceLine" id="cb340-14" title="14">  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>)</a>
<a class="sourceLine" id="cb340-15" title="15">)</a>
<a class="sourceLine" id="cb340-16" title="16"></a>
<a class="sourceLine" id="cb340-17" title="17">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</a>
<a class="sourceLine" id="cb340-18" title="18"></a>
<a class="sourceLine" id="cb340-19" title="19">  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</a>
<a class="sourceLine" id="cb340-20" title="20">    <span class="kw">gio</span>(arcs, i, e, v)</a>
<a class="sourceLine" id="cb340-21" title="21">  })</a>
<a class="sourceLine" id="cb340-22" title="22"></a>
<a class="sourceLine" id="cb340-23" title="23">  <span class="kw">observeEvent</span>(input<span class="op">$</span>load, {</a>
<a class="sourceLine" id="cb340-24" title="24">    <span class="kw">gio_proxy</span>(<span class="st">&quot;globe&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb340-25" title="25"><span class="st">      </span><span class="kw">gio_send_data</span>(arcs, i, e, v)</a>
<a class="sourceLine" id="cb340-26" title="26">  })</a>
<a class="sourceLine" id="cb340-27" title="27"></a>
<a class="sourceLine" id="cb340-28" title="28">  <span class="kw">observeEvent</span>(input<span class="op">$</span>clear, {</a>
<a class="sourceLine" id="cb340-29" title="29">    <span class="kw">gio_proxy</span>(<span class="st">&quot;globe&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb340-30" title="30"><span class="st">      </span><span class="kw">gio_clear_data</span>()</a>
<a class="sourceLine" id="cb340-31" title="31">  })</a>
<a class="sourceLine" id="cb340-32" title="32"></a>
<a class="sourceLine" id="cb340-33" title="33">}</a>
<a class="sourceLine" id="cb340-34" title="34"></a>
<a class="sourceLine" id="cb340-35" title="35"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:giod-shiny-clear-data"></span>
<img src="images/gio-shiny-clear.png" alt="Gio with clear data proxy" width="100%" />
<p class="caption">
FIGURE 17.4: Gio with clear data proxy
</p>
</div>
</div>
<div id="shiny-widgets-update" class="section level2">
<h2><span class="header-section-number">17.6</span> Update the Widget</h2>
<p>The previous proxies defined worked for reasons unbeknownst to the author of this book. It will not work with all methods. The reason it will not work is one that is likely to occur with many other visualisation libraries. For instance, one can attempt to develop a function to dynamically change the style without having to redraw the entire globe, starting again with the R function.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb341-1" title="1"><span class="co">#&#39; @export</span></a>
<a class="sourceLine" id="cb341-2" title="2">gio_set_style &lt;-<span class="st"> </span><span class="cf">function</span>(proxy, style){</a>
<a class="sourceLine" id="cb341-3" title="3">  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> proxy<span class="op">$</span>id, <span class="dt">style =</span> style)</a>
<a class="sourceLine" id="cb341-4" title="4">  proxy<span class="op">$</span>session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;set-style&quot;</span>, message)</a>
<a class="sourceLine" id="cb341-5" title="5">  <span class="kw">return</span>(proxy)</a>
<a class="sourceLine" id="cb341-6" title="6">}</a></code></pre></div>
<p>Then, adding the JavaScript handler.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb342-1" title="1"><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(</a>
<a class="sourceLine" id="cb342-2" title="2">  type <span class="op">=</span> <span class="st">&#39;set-style&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></a>
<a class="sourceLine" id="cb342-3" title="3">    <span class="kw">var</span> controller <span class="op">=</span> <span class="at">get_gio</span>(<span class="va">message</span>.<span class="at">id</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb342-4" title="4">    <span class="va">controller</span>.<span class="at">setStyle</span>(<span class="va">message</span>.<span class="at">style</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb342-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>At this stage, one can try the function in a Shiny application, but it will not work because most such methods that change underlying aspects of a visualisation will not be reflected in real-time. Gio.js, and many other libraries, will require one to explicitly ask for an update so the changes take effect. This has multiple advantages, one can stack multiple visual changes to execute them at the same time, and one can manage the load on the front end.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb343-1" title="1"><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(</a>
<a class="sourceLine" id="cb343-2" title="2">  type <span class="op">=</span> <span class="st">&#39;set-style&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></a>
<a class="sourceLine" id="cb343-3" title="3">    <span class="kw">var</span> controller <span class="op">=</span> <span class="at">get_gio</span>(<span class="va">message</span>.<span class="at">id</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb343-4" title="4">    <span class="va">controller</span>.<span class="at">setStyle</span>(<span class="va">message</span>.<span class="at">style</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb343-5" title="5">    <span class="va">controller</span>.<span class="at">update</span>()<span class="op">;</span> <span class="co">// force update the visualisation</span></a>
<a class="sourceLine" id="cb343-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>This forces the chart to update, applying the new style. Below we write an application that provides a dropdown to switch between two styles.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" title="1"><span class="kw">library</span>(gio)</a>
<a class="sourceLine" id="cb344-2" title="2"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb344-3" title="3"></a>
<a class="sourceLine" id="cb344-4" title="4"><span class="co"># two phoney datasets</span></a>
<a class="sourceLine" id="cb344-5" title="5">arcs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb344-6" title="6">  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>),</a>
<a class="sourceLine" id="cb344-7" title="7">  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>, <span class="st">&quot;US&quot;</span>),</a>
<a class="sourceLine" id="cb344-8" title="8">  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</a>
<a class="sourceLine" id="cb344-9" title="9">)</a>
<a class="sourceLine" id="cb344-10" title="10"></a>
<a class="sourceLine" id="cb344-11" title="11">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb344-12" title="12">  <span class="kw">selectInput</span>(</a>
<a class="sourceLine" id="cb344-13" title="13">    <span class="st">&quot;style&quot;</span>, </a>
<a class="sourceLine" id="cb344-14" title="14">    <span class="st">&quot;Select a style&quot;</span>, </a>
<a class="sourceLine" id="cb344-15" title="15">    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;blueInk&quot;</span>, <span class="st">&quot;earlySpring&quot;</span>)</a>
<a class="sourceLine" id="cb344-16" title="16">  ),</a>
<a class="sourceLine" id="cb344-17" title="17">  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>)</a>
<a class="sourceLine" id="cb344-18" title="18">)</a>
<a class="sourceLine" id="cb344-19" title="19"></a>
<a class="sourceLine" id="cb344-20" title="20">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</a>
<a class="sourceLine" id="cb344-21" title="21">  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</a>
<a class="sourceLine" id="cb344-22" title="22">    <span class="kw">gio</span>(arcs1, i, e , v)</a>
<a class="sourceLine" id="cb344-23" title="23">  })</a>
<a class="sourceLine" id="cb344-24" title="24"></a>
<a class="sourceLine" id="cb344-25" title="25">  <span class="kw">observeEvent</span>(input<span class="op">$</span>style, {</a>
<a class="sourceLine" id="cb344-26" title="26">    <span class="kw">gio_proxy</span>(<span class="st">&quot;globe&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb344-27" title="27"><span class="st">      </span><span class="kw">gio_set_style</span>(input<span class="op">$</span>style)</a>
<a class="sourceLine" id="cb344-28" title="28">  })</a>
<a class="sourceLine" id="cb344-29" title="29"></a>
<a class="sourceLine" id="cb344-30" title="30">}</a>
<a class="sourceLine" id="cb344-31" title="31"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gio-shiny-style"></span>
<img src="images/gio-shiny-style.png" alt="Gio with dynamic style" width="100%" />
<p class="caption">
FIGURE 17.5: Gio with dynamic style
</p>
</div>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="shiny-cookies.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="v8.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/JohnCoene/javascript-for-r/edit/master/4-18-shiny-htmlwidgets.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
