<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 12 A Complete Integration | JavaScript for R</title>
  <meta name="description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 12 A Complete Integration | JavaScript for R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="github-repo" content="JohnCoene/javascript-for-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 12 A Complete Integration | JavaScript for R" />
  
  <meta name="twitter:description" content="Invite JavaScript into your Data Science workflow." />
  

<meta name="author" content="John Coene" />


<meta name="date" content="2020-12-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="shiny-intro.html"/>
<link rel="next" href="shiny-tips.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<script src="libs/core-js-2.5.3/shim.min.js"></script>
<script src="libs/react-16.12.0/react.min.js"></script>
<script src="libs/react-16.12.0/react-dom.min.js"></script>
<script src="libs/reactwidget-1.0.0/react-tools.js"></script>
<script src="libs/reactable-binding-0.2.3/reactable.js"></script>
<script src="libs/r2d3-render-0.1.0/r2d3-render.js"></script>
<script src="libs/webcomponents-2.0.0/webcomponents.js"></script>
<script src="libs/r2d3-binding-0.2.3/r2d3.js"></script>
<script src="libs/d3v5-5.0.0/d3.min.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.16/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-74544116-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74544116-1');
</script>
<meta property="og:title" content="Chapter 12 A Complete Integration | JavaScript for R">
<meta property="og:description" content="Book on using JavaScript with R for visualisations, web development, and computations.">
<meta property="og:image" content="https://book.javascript-for-r.com/images/social.png">
<meta property="og:url" content="https://book.javascript-for-r.com/">
<meta name="twitter:card" content="summary_large_image">
<meta property="og:site_name" content="Chapter 12 A Complete Integration | JavaScript for R">
<meta name="twitter:image:alt" content="Book on using JavaScript with R for visualisations, web development, and computations.">
<meta name="twitter:site" content="@jdatap">


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">JavaScript for R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#premise"><i class="fa fa-check"></i>Premise</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>Book Structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgement"><i class="fa fa-check"></i>Acknowledgement</a></li>
</ul></li>
<li class="part"><span><b>I Basics &amp; Roadmap</b></span></li>
<li class="chapter" data-level="1" data-path="intro-overview.html"><a href="intro-overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro-overview.html"><a href="intro-overview.html#intro-overview-rationale"><i class="fa fa-check"></i><b>1.1</b> Rationale</a></li>
<li class="chapter" data-level="1.2" data-path="intro-overview.html"><a href="intro-overview.html#intro-methods"><i class="fa fa-check"></i><b>1.2</b> Methods</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro-overview.html"><a href="intro-overview.html#intro-v8"><i class="fa fa-check"></i><b>1.2.1</b> V8</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro-overview.html"><a href="intro-overview.html#intro-htmlwidgets"><i class="fa fa-check"></i><b>1.2.2</b> htmlwidgets</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro-overview.html"><a href="intro-overview.html#intro-shiny"><i class="fa fa-check"></i><b>1.2.3</b> Shiny</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro-overview.html"><a href="intro-overview.html#intro-amiss"><i class="fa fa-check"></i><b>1.3</b> Methods Amiss</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro-overview.html"><a href="intro-overview.html#intro-reactr-vuer"><i class="fa fa-check"></i><b>1.3.1</b> reactR &amp; vueR</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro-overview.html"><a href="intro-overview.html#intro-r2d3"><i class="fa fa-check"></i><b>1.3.2</b> r2d3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>2</b> Prerequisites</a>
<ul>
<li class="chapter" data-level="2.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-package-dev"><i class="fa fa-check"></i><b>2.1</b> R Package Development</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-create-pkg"><i class="fa fa-check"></i><b>2.1.1</b> Creating a Package</a></li>
<li class="chapter" data-level="2.1.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-metadata"><i class="fa fa-check"></i><b>2.1.2</b> Metadata</a></li>
<li class="chapter" data-level="2.1.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-r-code"><i class="fa fa-check"></i><b>2.1.3</b> R code</a></li>
<li class="chapter" data-level="2.1.4" data-path="prerequisites.html"><a href="prerequisites.html#basics-documentation"><i class="fa fa-check"></i><b>2.1.4</b> Documentation</a></li>
<li class="chapter" data-level="2.1.5" data-path="prerequisites.html"><a href="prerequisites.html#basics-installed-files"><i class="fa fa-check"></i><b>2.1.5</b> Installed files</a></li>
<li class="chapter" data-level="2.1.6" data-path="prerequisites.html"><a href="prerequisites.html#basics-build-load-install"><i class="fa fa-check"></i><b>2.1.6</b> Build, load, and install</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-json"><i class="fa fa-check"></i><b>2.2</b> JSON</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="prerequisites.html"><a href="prerequisites.html#serialising"><i class="fa fa-check"></i><b>2.2.1</b> Serialising</a></li>
<li class="chapter" data-level="2.2.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-tabular"><i class="fa fa-check"></i><b>2.2.2</b> Tabular Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-javascript"><i class="fa fa-check"></i><b>2.3</b> JavaScript</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-chrome-devtools"><i class="fa fa-check"></i><b>2.3.1</b> Developer Tools</a></li>
<li class="chapter" data-level="2.3.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-var-scope"><i class="fa fa-check"></i><b>2.3.2</b> Variable Declaration and Scope</a></li>
<li class="chapter" data-level="2.3.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-object-model"><i class="fa fa-check"></i><b>2.3.3</b> Document Object Model</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="prerequisites.html"><a href="prerequisites.html#basics-shiny"><i class="fa fa-check"></i><b>2.4</b> Shiny</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-static-files"><i class="fa fa-check"></i><b>2.4.1</b> Serving Static Files</a></li>
<li class="chapter" data-level="2.4.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-htmltools"><i class="fa fa-check"></i><b>2.4.2</b> Htmltools</a></li>
<li class="chapter" data-level="2.4.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-deps-pro-cons"><i class="fa fa-check"></i><b>2.4.3</b> Serving vs. htmltools</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Data Visualisation</b></span></li>
<li class="chapter" data-level="3" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html"><i class="fa fa-check"></i><b>3</b> Introduction to Widgets</a>
<ul>
<li class="chapter" data-level="3.1" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-plotly"><i class="fa fa-check"></i><b>3.1</b> Plotly package</a></li>
<li class="chapter" data-level="3.2" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-intro-dt"><i class="fa fa-check"></i><b>3.2</b> DT package</a></li>
<li class="chapter" data-level="3.3" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-intro-crosstalk"><i class="fa fa-check"></i><b>3.3</b> Crosstalk</a></li>
<li class="chapter" data-level="3.4" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-intro-conclude"><i class="fa fa-check"></i><b>3.4</b> Wrap-up</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="widgets-basics.html"><a href="widgets-basics.html"><i class="fa fa-check"></i><b>4</b> Basics of Building Widgets</a>
<ul>
<li class="chapter" data-level="4.1" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-study"><i class="fa fa-check"></i><b>4.1</b> Read &amp; Study</a></li>
<li class="chapter" data-level="4.2" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates"><i class="fa fa-check"></i><b>4.2</b> Candidate Libraries</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates-plotly"><i class="fa fa-check"></i><b>4.2.1</b> Plotly.js</a></li>
<li class="chapter" data-level="4.2.2" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates-highcharts"><i class="fa fa-check"></i><b>4.2.2</b> Highchart.js</a></li>
<li class="chapter" data-level="4.2.3" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates-chart.js"><i class="fa fa-check"></i><b>4.2.3</b> Chart.js</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-inner-workings"><i class="fa fa-check"></i><b>4.3</b> How it works</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="widgets-first.html"><a href="widgets-first.html"><i class="fa fa-check"></i><b>5</b> Your First Widget</a>
<ul>
<li class="chapter" data-level="5.1" data-path="widgets-first.html"><a href="widgets-first.html#widgets-first-scaffold"><i class="fa fa-check"></i><b>5.1</b> The Scaffold</a></li>
<li class="chapter" data-level="5.2" data-path="widgets-first.html"><a href="widgets-first.html#widgets-first-htmloutput"><i class="fa fa-check"></i><b>5.2</b> The HTML Output</a></li>
<li class="chapter" data-level="5.3" data-path="widgets-first.html"><a href="widgets-first.html#widgets-first-js-files"><i class="fa fa-check"></i><b>5.3</b> JavaScript Files</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="widgets-realistic.html"><a href="widgets-realistic.html"><i class="fa fa-check"></i><b>6</b> A Realistic Widget</a>
<ul>
<li class="chapter" data-level="6.1" data-path="widgets-realistic.html"><a href="widgets-realistic.html#widgets-realistic-deps"><i class="fa fa-check"></i><b>6.1</b> Dependencies</a></li>
<li class="chapter" data-level="6.2" data-path="widgets-realistic.html"><a href="widgets-realistic.html#widgets-realistic-implementation"><i class="fa fa-check"></i><b>6.2</b> Implementation</a></li>
<li class="chapter" data-level="6.3" data-path="widgets-realistic.html"><a href="widgets-realistic.html#widgets-realistic-html-element"><i class="fa fa-check"></i><b>6.3</b> HTML Element</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="widgets-full.html"><a href="widgets-full.html"><i class="fa fa-check"></i><b>7</b> The Full Monty</a>
<ul>
<li class="chapter" data-level="7.1" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-deps"><i class="fa fa-check"></i><b>7.1</b> Dependencies</a></li>
<li class="chapter" data-level="7.2" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-js"><i class="fa fa-check"></i><b>7.2</b> JavaScript</a></li>
<li class="chapter" data-level="7.3" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-data"><i class="fa fa-check"></i><b>7.3</b> Working with Data</a></li>
<li class="chapter" data-level="7.4" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data"><i class="fa fa-check"></i><b>7.4</b> Transforming Data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-js"><i class="fa fa-check"></i><b>7.4.1</b> Using JavaScript</a></li>
<li class="chapter" data-level="7.4.2" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-modify"><i class="fa fa-check"></i><b>7.4.2</b> Modify Serialiser</a></li>
<li class="chapter" data-level="7.4.3" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-replace"><i class="fa fa-check"></i><b>7.4.3</b> Replace Serialiser</a></li>
<li class="chapter" data-level="7.4.4" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-modify-data"><i class="fa fa-check"></i><b>7.4.4</b> Modify the Data</a></li>
<li class="chapter" data-level="7.4.5" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-conclusion"><i class="fa fa-check"></i><b>7.4.5</b> Pros &amp; Cons</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-on-print"><i class="fa fa-check"></i><b>7.5</b> On Print Method</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="widgets-adv.html"><a href="widgets-adv.html"><i class="fa fa-check"></i><b>8</b> Advanced Topics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-shared"><i class="fa fa-check"></i><b>8.1</b> Shared Variables</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-sizing"><i class="fa fa-check"></i><b>8.1.1</b> Sizing</a></li>
<li class="chapter" data-level="8.1.2" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-sizing-policy"><i class="fa fa-check"></i><b>8.1.2</b> Sizing Policy</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-resizing"><i class="fa fa-check"></i><b>8.2</b> Resizing</a></li>
<li class="chapter" data-level="8.3" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-prerender"><i class="fa fa-check"></i><b>8.3</b> Pre Render Hooks &amp; Security</a></li>
<li class="chapter" data-level="8.4" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-js"><i class="fa fa-check"></i><b>8.4</b> JavaScript Code</a></li>
<li class="chapter" data-level="8.5" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-prepend-append"><i class="fa fa-check"></i><b>8.5</b> Prepend &amp; Append Content</a></li>
<li class="chapter" data-level="8.6" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-dependencies"><i class="fa fa-check"></i><b>8.6</b> Dependencies</a></li>
<li class="chapter" data-level="8.7" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-compatibility"><i class="fa fa-check"></i><b>8.7</b> Compatibility</a></li>
<li class="chapter" data-level="8.8" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-unit-tests"><i class="fa fa-check"></i><b>8.8</b> Unit Tests</a></li>
<li class="chapter" data-level="8.9" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-performances"><i class="fa fa-check"></i><b>8.9</b> Performances</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="linking-widgets.html"><a href="linking-widgets.html"><i class="fa fa-check"></i><b>9</b> Linking Widgets</a>
<ul>
<li class="chapter" data-level="9.1" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-examples"><i class="fa fa-check"></i><b>9.1</b> Crosstalk Examples</a></li>
<li class="chapter" data-level="9.2" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-req"><i class="fa fa-check"></i><b>9.2</b> Crosstalk Requirements</a></li>
<li class="chapter" data-level="9.3" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-inner-workings"><i class="fa fa-check"></i><b>9.3</b> How it Works</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-keys"><i class="fa fa-check"></i><b>9.3.1</b> Keys</a></li>
<li class="chapter" data-level="9.3.2" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-communication-lines"><i class="fa fa-check"></i><b>9.3.2</b> Communication Lines</a></li>
<li class="chapter" data-level="9.3.3" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-groups"><i class="fa fa-check"></i><b>9.3.3</b> Groups</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-gio"><i class="fa fa-check"></i><b>9.4</b> Crosstalk with Gio</a></li>
<li class="chapter" data-level="9.5" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-r"><i class="fa fa-check"></i><b>9.5</b> R code</a></li>
<li class="chapter" data-level="9.6" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-js"><i class="fa fa-check"></i><b>9.6</b> JavaScript code</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-send-keys"><i class="fa fa-check"></i><b>9.6.1</b> Send Selected Keys</a></li>
<li class="chapter" data-level="9.6.2" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-set-keys"><i class="fa fa-check"></i><b>9.6.2</b> Set Selected Keys</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-using"><i class="fa fa-check"></i><b>9.7</b> Using Crosstalk with Gio</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="widgets-final.html"><a href="widgets-final.html"><i class="fa fa-check"></i><b>10</b> Final Revisions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-data"><i class="fa fa-check"></i><b>10.1</b> Htmlwidgets &amp; Data</a></li>
<li class="chapter" data-level="10.2" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-options"><i class="fa fa-check"></i><b>10.2</b> Plethora of Options</a></li>
<li class="chapter" data-level="10.3" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-interface"><i class="fa fa-check"></i><b>10.3</b> Interface Design</a></li>
<li class="chapter" data-level="10.4" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-exercises"><i class="fa fa-check"></i><b>10.4</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>III Web Development with Shiny</b></span></li>
<li class="chapter" data-level="11" data-path="shiny-intro.html"><a href="shiny-intro.html"><i class="fa fa-check"></i><b>11</b> Bidirectional Communication</a>
<ul>
<li class="chapter" data-level="11.1" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-websocket"><i class="fa fa-check"></i><b>11.1</b> Websocket &amp; Shiny</a></li>
<li class="chapter" data-level="11.2" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-example"><i class="fa fa-check"></i><b>11.2</b> Alerts, an example</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-explore"><i class="fa fa-check"></i><b>11.2.1</b> Explore</a></li>
<li class="chapter" data-level="11.2.2" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-r-to-js"><i class="fa fa-check"></i><b>11.2.2</b> From R to JavaScript</a></li>
<li class="chapter" data-level="11.2.3" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-serialise"><i class="fa fa-check"></i><b>11.2.3</b> Serialisation</a></li>
<li class="chapter" data-level="11.2.4" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-js2r"><i class="fa fa-check"></i><b>11.2.4</b> JavaScript to R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="shiny-complete.html"><a href="shiny-complete.html"><i class="fa fa-check"></i><b>12</b> A Complete Integration</a>
<ul>
<li class="chapter" data-level="12.1" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-discover"><i class="fa fa-check"></i><b>12.1</b> Discover</a></li>
<li class="chapter" data-level="12.2" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-setup"><i class="fa fa-check"></i><b>12.2</b> Setup</a></li>
<li class="chapter" data-level="12.3" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-dependencies"><i class="fa fa-check"></i><b>12.3</b> Dependencies</a></li>
<li class="chapter" data-level="12.4" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-images"><i class="fa fa-check"></i><b>12.4</b> Static files</a></li>
<li class="chapter" data-level="12.5" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-skeleton"><i class="fa fa-check"></i><b>12.5</b> Skeleton</a></li>
<li class="chapter" data-level="12.6" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-r2js"><i class="fa fa-check"></i><b>12.6</b> From R to JavaScript</a></li>
<li class="chapter" data-level="12.7" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-js2r"><i class="fa fa-check"></i><b>12.7</b> From JavaScript to R</a></li>
<li class="chapter" data-level="12.8" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-input-handler"><i class="fa fa-check"></i><b>12.8</b> Input handler</a></li>
<li class="chapter" data-level="12.9" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg"><i class="fa fa-check"></i><b>12.9</b> As a package</a>
<ul>
<li class="chapter" data-level="12.9.1" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-deps"><i class="fa fa-check"></i><b>12.9.1</b> Dependencies</a></li>
<li class="chapter" data-level="12.9.2" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-trigger"><i class="fa fa-check"></i><b>12.9.2</b> Trigger classification</a></li>
<li class="chapter" data-level="12.9.3" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-js-code"><i class="fa fa-check"></i><b>12.9.3</b> JavaScript code</a></li>
<li class="chapter" data-level="12.9.4" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-input-handler"><i class="fa fa-check"></i><b>12.9.4</b> Input handler</a></li>
<li class="chapter" data-level="12.9.5" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-test"><i class="fa fa-check"></i><b>12.9.5</b> Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="shiny-tips.html"><a href="shiny-tips.html"><i class="fa fa-check"></i><b>13</b> Tips &amp; Tricks</a>
<ul>
<li class="chapter" data-level="13.1" data-path="shiny-tips.html"><a href="shiny-tips.html#shiny-tips-events"><i class="fa fa-check"></i><b>13.1</b> Shiny Events</a></li>
<li class="chapter" data-level="13.2" data-path="shiny-tips.html"><a href="shiny-tips.html#shiny-tips-table-btn"><i class="fa fa-check"></i><b>13.2</b> Table Buttons</a></li>
<li class="chapter" data-level="13.3" data-path="shiny-tips.html"><a href="shiny-tips.html#shiny-tips-jQuery"><i class="fa fa-check"></i><b>13.3</b> jQuery</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="shiny-output.html"><a href="shiny-output.html"><i class="fa fa-check"></i><b>14</b> Custom Outputs</a>
<ul>
<li class="chapter" data-level="14.1" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-inner-workings"><i class="fa fa-check"></i><b>14.1</b> Inner-workings</a></li>
<li class="chapter" data-level="14.2" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-setup"><i class="fa fa-check"></i><b>14.2</b> Setup</a></li>
<li class="chapter" data-level="14.3" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-r-fun"><i class="fa fa-check"></i><b>14.3</b> Output R Function</a></li>
<li class="chapter" data-level="14.4" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-html"><i class="fa fa-check"></i><b>14.4</b> Generate Output HTML</a></li>
<li class="chapter" data-level="14.5" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-renderer"><i class="fa fa-check"></i><b>14.5</b> Output Renderer</a></li>
<li class="chapter" data-level="14.6" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-binding"><i class="fa fa-check"></i><b>14.6</b> JavaScript Output Binding</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-boxxy-title"><i class="fa fa-check"></i><b>14.6.1</b> Boxxy Title</a></li>
<li class="chapter" data-level="14.6.2" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-boxxy-value"><i class="fa fa-check"></i><b>14.6.2</b> Boxxy Value</a></li>
<li class="chapter" data-level="14.6.3" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-boxxy-bg-color"><i class="fa fa-check"></i><b>14.6.3</b> Boxxy Background Color</a></li>
<li class="chapter" data-level="14.6.4" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-register"><i class="fa fa-check"></i><b>14.6.4</b> Register the Output Binding</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-usage"><i class="fa fa-check"></i><b>14.7</b> Boxxy Usage</a></li>
<li class="chapter" data-level="14.8" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-inject"><i class="fa fa-check"></i><b>14.8</b> Injecting Dependencies</a></li>
<li class="chapter" data-level="14.9" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-preprocess"><i class="fa fa-check"></i><b>14.9</b> Preprocessing Custom Outputs</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="shiny-input.html"><a href="shiny-input.html"><i class="fa fa-check"></i><b>15</b> Custom Inputs</a>
<ul>
<li class="chapter" data-level="15.1" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-setup"><i class="fa fa-check"></i><b>15.1</b> Setup</a></li>
<li class="chapter" data-level="15.2" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-intro"><i class="fa fa-check"></i><b>15.2</b> Switch Input HTML &amp; Style</a></li>
<li class="chapter" data-level="15.3" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-html"><i class="fa fa-check"></i><b>15.3</b> Generate Input HTML</a></li>
<li class="chapter" data-level="15.4" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-binding"><i class="fa fa-check"></i><b>15.4</b> JavaScript Input Binding</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-find"><i class="fa fa-check"></i><b>15.4.1</b> Find Inputs</a></li>
<li class="chapter" data-level="15.4.2" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-get-id"><i class="fa fa-check"></i><b>15.4.2</b> Get Input Id</a></li>
<li class="chapter" data-level="15.4.3" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-get-value"><i class="fa fa-check"></i><b>15.4.3</b> Get Input Value</a></li>
<li class="chapter" data-level="15.4.4" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-set-value"><i class="fa fa-check"></i><b>15.4.4</b> Set Input Value</a></li>
<li class="chapter" data-level="15.4.5" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-receive-msg"><i class="fa fa-check"></i><b>15.4.5</b> Receive Input Messages</a></li>
<li class="chapter" data-level="15.4.6" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-sub-unsub"><i class="fa fa-check"></i><b>15.4.6</b> Subscribe &amp; Unsubscribe Inputs</a></li>
<li class="chapter" data-level="15.4.7" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-rate-policy"><i class="fa fa-check"></i><b>15.4.7</b> Input Rate Policy</a></li>
<li class="chapter" data-level="15.4.8" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-register"><i class="fa fa-check"></i><b>15.4.8</b> Registering the Input Binding</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-update"><i class="fa fa-check"></i><b>15.5</b> Update Input</a></li>
<li class="chapter" data-level="15.6" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-excercise"><i class="fa fa-check"></i><b>15.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="shiny-cookies.html"><a href="shiny-cookies.html"><i class="fa fa-check"></i><b>16</b> Cookies</a>
<ul>
<li class="chapter" data-level="16.1" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-discover"><i class="fa fa-check"></i><b>16.1</b> Discover js-cookie</a></li>
<li class="chapter" data-level="16.2" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-setup"><i class="fa fa-check"></i><b>16.2</b> Setup Project</a></li>
<li class="chapter" data-level="16.3" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-javascript"><i class="fa fa-check"></i><b>16.3</b> JavaScript Cookies</a></li>
<li class="chapter" data-level="16.4" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-r-code"><i class="fa fa-check"></i><b>16.4</b> R Code</a></li>
<li class="chapter" data-level="16.5" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-exercises"><i class="fa fa-check"></i><b>16.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="shiny-widgets.html"><a href="shiny-widgets.html"><i class="fa fa-check"></i><b>17</b> Widgets with Shiny</a>
<ul>
<li class="chapter" data-level="17.1" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-to-r"><i class="fa fa-check"></i><b>17.1</b> Widgets to R</a></li>
<li class="chapter" data-level="17.2" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-handlers"><i class="fa fa-check"></i><b>17.2</b> Input Handlers for Widgets</a></li>
<li class="chapter" data-level="17.3" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-r-to-widgets"><i class="fa fa-check"></i><b>17.3</b> R to Widgets</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-send-data"><i class="fa fa-check"></i><b>17.3.1</b> Send Data from Widgets</a></li>
<li class="chapter" data-level="17.3.2" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-retrieve"><i class="fa fa-check"></i><b>17.3.2</b> Retrieve Widget Instance</a></li>
<li class="chapter" data-level="17.3.3" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-handle-data"><i class="fa fa-check"></i><b>17.3.3</b> Handle Data</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-proxy"><i class="fa fa-check"></i><b>17.4</b> Proxy Function</a></li>
<li class="chapter" data-level="17.5" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-clear-data"><i class="fa fa-check"></i><b>17.5</b> Clear Data</a></li>
<li class="chapter" data-level="17.6" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-update"><i class="fa fa-check"></i><b>17.6</b> Update the Widget</a></li>
</ul></li>
<li class="part"><span><b>IV JavaScript for Computations</b></span></li>
<li class="chapter" data-level="18" data-path="v8.html"><a href="v8.html"><i class="fa fa-check"></i><b>18</b> The V8 Engine</a>
<ul>
<li class="chapter" data-level="18.1" data-path="v8.html"><a href="v8.html#v8-installation"><i class="fa fa-check"></i><b>18.1</b> Installation</a></li>
<li class="chapter" data-level="18.2" data-path="v8.html"><a href="v8.html#v8-basics"><i class="fa fa-check"></i><b>18.2</b> Basics</a></li>
<li class="chapter" data-level="18.3" data-path="v8.html"><a href="v8.html#v8-external"><i class="fa fa-check"></i><b>18.3</b> External Libraries</a></li>
<li class="chapter" data-level="18.4" data-path="v8.html"><a href="v8.html#v8-npm"><i class="fa fa-check"></i><b>18.4</b> NPM Packages</a></li>
<li class="chapter" data-level="18.5" data-path="v8.html"><a href="v8.html#v8-pkg"><i class="fa fa-check"></i><b>18.5</b> Use in Packages</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="v8-ml.html"><a href="v8-ml.html"><i class="fa fa-check"></i><b>19</b> Machine Learning</a>
<ul>
<li class="chapter" data-level="19.1" data-path="v8-ml.html"><a href="v8-ml.html#v8-ml-dependency"><i class="fa fa-check"></i><b>19.1</b> Dependency</a></li>
<li class="chapter" data-level="19.2" data-path="v8-ml.html"><a href="v8-ml.html#v8-ml-regression"><i class="fa fa-check"></i><b>19.2</b> Simple Regression</a></li>
<li class="chapter" data-level="19.3" data-path="v8-ml.html"><a href="v8-ml.html#v8-ml-exercises"><i class="fa fa-check"></i><b>19.3</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>V Robust JavaScript</b></span></li>
<li class="chapter" data-level="20" data-path="webpack-intro.html"><a href="webpack-intro.html"><i class="fa fa-check"></i><b>20</b> Managing JavaScript</a>
<ul>
<li class="chapter" data-level="20.1" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-example"><i class="fa fa-check"></i><b>20.1</b> Example</a></li>
<li class="chapter" data-level="20.2" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-browser"><i class="fa fa-check"></i><b>20.2</b> Transpiling</a></li>
<li class="chapter" data-level="20.3" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-minification"><i class="fa fa-check"></i><b>20.3</b> Minification</a></li>
<li class="chapter" data-level="20.4" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-structure"><i class="fa fa-check"></i><b>20.4</b> Bundling &amp; Modules</a></li>
<li class="chapter" data-level="20.5" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-decouple"><i class="fa fa-check"></i><b>20.5</b> Decoupling</a></li>
<li class="chapter" data-level="20.6" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-npm"><i class="fa fa-check"></i><b>20.6</b> NPM</a></li>
<li class="chapter" data-level="20.7" data-path="webpack-intro.html"><a href="webpack-intro.html#webpack-conclude"><i class="fa fa-check"></i><b>20.7</b> With R</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html"><i class="fa fa-check"></i><b>21</b> Discover Webpack and NPM</a>
<ul>
<li class="chapter" data-level="21.1" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install"><i class="fa fa-check"></i><b>21.1</b> Installation</a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-mac"><i class="fa fa-check"></i><b>21.1.1</b> Mac OS</a></li>
<li class="chapter" data-level="21.1.2" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-ubuntu"><i class="fa fa-check"></i><b>21.1.2</b> Ubuntu</a></li>
<li class="chapter" data-level="21.1.3" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-windows"><i class="fa fa-check"></i><b>21.1.3</b> Windows</a></li>
<li class="chapter" data-level="21.1.4" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-other"><i class="fa fa-check"></i><b>21.1.4</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-setup"><i class="fa fa-check"></i><b>21.2</b> Setup the app</a></li>
<li class="chapter" data-level="21.3" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-init-npm"><i class="fa fa-check"></i><b>21.3</b> Initialise NPM</a></li>
<li class="chapter" data-level="21.4" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-install-pkgs"><i class="fa fa-check"></i><b>21.4</b> Installing NPM packages</a></li>
<li class="chapter" data-level="21.5" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-entry-points"><i class="fa fa-check"></i><b>21.5</b> Entry point &amp; output</a></li>
<li class="chapter" data-level="21.6" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-conf"><i class="fa fa-check"></i><b>21.6</b> Configuration file</a></li>
<li class="chapter" data-level="21.7" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-npm-scripts"><i class="fa fa-check"></i><b>21.7</b> NPM scripts</a></li>
<li class="chapter" data-level="21.8" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-webpack-mode"><i class="fa fa-check"></i><b>21.8</b> Source maps</a></li>
<li class="chapter" data-level="21.9" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-bundle"><i class="fa fa-check"></i><b>21.9</b> Bundle</a></li>
<li class="chapter" data-level="21.10" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-internal-dependencies"><i class="fa fa-check"></i><b>21.10</b> Internal Dependencies</a></li>
<li class="chapter" data-level="21.11" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-external-dependencies"><i class="fa fa-check"></i><b>21.11</b> External Dependencies</a></li>
<li class="chapter" data-level="21.12" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-import-export"><i class="fa fa-check"></i><b>21.12</b> Import &amp; Export</a>
<ul>
<li class="chapter" data-level="21.12.1" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-import-export-named"><i class="fa fa-check"></i><b>21.12.1</b> Named</a></li>
<li class="chapter" data-level="21.12.2" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-import-export-default"><i class="fa fa-check"></i><b>21.12.2</b> Default</a></li>
<li class="chapter" data-level="21.12.3" data-path="webpack-intro-discover.html"><a href="webpack-intro-discover.html#webpack-intro-import-export-wrap-up"><i class="fa fa-check"></i><b>21.12.3</b> Wrap up</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="packer-overview.html"><a href="packer-overview.html"><i class="fa fa-check"></i><b>22</b> Webpack with R</a>
<ul>
<li class="chapter" data-level="22.1" data-path="packer-overview.html"><a href="packer-overview.html#packer-principles"><i class="fa fa-check"></i><b>22.1</b> Principles of packer</a></li>
<li class="chapter" data-level="22.2" data-path="packer-overview.html"><a href="packer-overview.html#packer-scaffolds"><i class="fa fa-check"></i><b>22.2</b> Scaffolds</a></li>
<li class="chapter" data-level="22.3" data-path="packer-overview.html"><a href="packer-overview.html#packer-inputs"><i class="fa fa-check"></i><b>22.3</b> Inputs</a></li>
<li class="chapter" data-level="22.4" data-path="packer-overview.html"><a href="packer-overview.html#packer-r-file"><i class="fa fa-check"></i><b>22.4</b> R file</a></li>
<li class="chapter" data-level="22.5" data-path="packer-overview.html"><a href="packer-overview.html#packer-js-files"><i class="fa fa-check"></i><b>22.5</b> JavaScript files</a></li>
<li class="chapter" data-level="22.6" data-path="packer-overview.html"><a href="packer-overview.html#packer-bundle"><i class="fa fa-check"></i><b>22.6</b> Bundle</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="packer-adv.html"><a href="packer-adv.html"><i class="fa fa-check"></i><b>23</b> Webpack Advanced</a>
<ul>
<li class="chapter" data-level="23.1" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-widgets"><i class="fa fa-check"></i><b>23.1</b> Widgets</a></li>
<li class="chapter" data-level="23.2" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-shiny-vue"><i class="fa fa-check"></i><b>23.2</b> Shiny with Vue &amp; Bootstrap 4</a>
<ul>
<li class="chapter" data-level="23.2.1" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-shiny-vue-setup"><i class="fa fa-check"></i><b>23.2.1</b> Setup</a></li>
<li class="chapter" data-level="23.2.2" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-shiny-vue-bs4"><i class="fa fa-check"></i><b>23.2.2</b> Bootstrap 4 installation</a></li>
<li class="chapter" data-level="23.2.3" data-path="packer-adv.html"><a href="packer-adv.html#packer-adv-shiny-vue-code"><i class="fa fa-check"></i><b>23.2.3</b> Vue code</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Closing Remarks</b></span></li>
<li class="chapter" data-level="24" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>24</b> Conclusion</a>
<ul>
<li class="chapter" data-level="24.1" data-path="conclusion.html"><a href="conclusion.html#conclusion-performances"><i class="fa fa-check"></i><b>24.1</b> Performances</a></li>
<li class="chapter" data-level="24.2" data-path="conclusion.html"><a href="conclusion.html#conclusion-trial-and-error"><i class="fa fa-check"></i><b>24.2</b> Trial &amp; Error</a></li>
<li class="chapter" data-level="24.3" data-path="conclusion.html"><a href="conclusion.html#conclusion-ux"><i class="fa fa-check"></i><b>24.3</b> Functionality &amp; UX</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">JavaScript for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="shiny-complete" class="section level1" number="12">
<h1><span class="header-section-number">Chapter 12</span> A Complete Integration</h1>
<p>Thus far, this part of the book has covered both ways data travels between JavaScript and R in Shiny. However, the notices displayed in the previous chapter, though demonstrates how both languages can work together within shiny, comes short of illustrating some more advanced use cases, how to package such code and more.</p>
<p>We shall introduce a fascinating JavaScript library that enables running machine learning models in web browsers: <a href="https://learn.ml5js.org/">ml5.js</a>. The library is a high-level interface to <a href="https://www.tensorflow.org/js">tensorflow.js</a> but very extensive as it includes a multitude of models to deal with sound, image, text, and more. In this chapter, one of those models is implemented, an image classifier using <a href="https://arxiv.org/abs/1704.04861">mobileNet</a>, but the method shown can be used to integrate any other model later on.</p>
<p>This is not a gimmick, running a model this way means it runs in the client (web browsers), and not on the shiny server leaving it free to compute anything else and serve other concurrent users. It’s also fast; JavaScript is often wrongly believed to be slow, on the contrary. Finally, the JavaScript API provided is straightforward; it’s impressive how ml5.js exposes complex models through such a simple API.</p>
<p>For those who want to take it further, may already now TensorFlow and want to use a lower-level library, the genius of <a href="https://www.tensorflow.org/js">tensorflow.js</a> is that it runs on WebGL and is therefore GPU-accelerated, i.e. it’s not slow, and has a very similar API to the TensorFlow Python library.</p>
<p>We start by exploring ml5.js, then plan the shiny application that will make use of it, and finally, we wrap our work in the form of an R package.</p>
<div id="shiny-complete-discover" class="section level2" number="12.1">
<h2><span class="header-section-number">12.1</span> Discover</h2>
<p>As for all projects that involve external libraries, the very first thing to do is to scan the documentation to understand how it is used. The documentation of ml5.js is exemplary, filled with examples and crystal clear, <a href="https://learn.ml5js.org/#/reference/image-classifier">it gives the following example</a> for the image classifier.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb213-1"><a href="shiny-complete.html#cb213-1"></a><span class="co">// Initialize the Image Classifier method with MobileNet</span></span>
<span id="cb213-2"><a href="shiny-complete.html#cb213-2"></a><span class="kw">const</span> classifier <span class="op">=</span> ml5<span class="op">.</span><span class="fu">imageClassifier</span>(<span class="st">&#39;MobileNet&#39;</span><span class="op">,</span> modelLoaded)<span class="op">;</span></span>
<span id="cb213-3"><a href="shiny-complete.html#cb213-3"></a></span>
<span id="cb213-4"><a href="shiny-complete.html#cb213-4"></a><span class="co">// When the model is loaded</span></span>
<span id="cb213-5"><a href="shiny-complete.html#cb213-5"></a><span class="kw">function</span> <span class="fu">modelLoaded</span>() {</span>
<span id="cb213-6"><a href="shiny-complete.html#cb213-6"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Model Loaded!&#39;</span>)<span class="op">;</span></span>
<span id="cb213-7"><a href="shiny-complete.html#cb213-7"></a>}</span>
<span id="cb213-8"><a href="shiny-complete.html#cb213-8"></a></span>
<span id="cb213-9"><a href="shiny-complete.html#cb213-9"></a><span class="co">// Make a prediction with a selected image</span></span>
<span id="cb213-10"><a href="shiny-complete.html#cb213-10"></a>classifier<span class="op">.</span><span class="fu">classify</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;image&#39;</span>)<span class="op">,</span> (err<span class="op">,</span> results) <span class="kw">=&gt;</span> {</span>
<span id="cb213-11"><a href="shiny-complete.html#cb213-11"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(results)<span class="op">;</span></span>
<span id="cb213-12"><a href="shiny-complete.html#cb213-12"></a>})<span class="op">;</span></span></code></pre></div>
<p>First, the image <code>classifier</code> is initialised from the <code>ml5</code> object with the <code>imageClassifier</code> method. This method takes two arguments, the name of the pre-trained model to use (<code>MobileNet</code>) and a callback function that is run when the model is loaded. The the <code>classify</code> method from the <code>classifier</code> is used with, again, two arguments: 1) the DOM element that contains the image (<code>&lt;img /&gt;</code>) and a callback function to do something with the results of the classification.</p>
<p>Now we can jump to the next section to think about how this can be implemented in Shiny.</p>
</div>
<div id="shiny-complete-setup" class="section level2" number="12.2">
<h2><span class="header-section-number">12.2</span> Setup</h2>
<p>In shiny, a dropdown menu could be provided to choose from pre-selected images, and upon selection, the server renders the selected image, at the click of a button the model then runs and sends the results to the R server which prints them in the UI.</p>
<p>This makes for what is probably a signature of shiny: a considerable amount of bi-directional communication between the server and client as shiny makes the most of the WebSocket. Some of the readers with more advanced knowledge in JavaScript will find ways to avoid the use of the server in places to do more in the client, either way, works.</p>
</div>
<div id="shiny-complete-dependencies" class="section level2" number="12.3">
<h2><span class="header-section-number">12.3</span> Dependencies</h2>
<p>The ml5.js framework and all its components are bundled in a single JavaScript file.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb214-1"><a href="shiny-complete.html#cb214-1"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://unpkg.com/ml5@0.4.3/dist/ml5.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span></code></pre></div>
<p>We will create an <code>html_dependency</code> object using the <code>htmlDependency</code> function from the htmltools package. If confused, go back to the first part of the book on shiny prerequisites where it is explained in greater detail.</p>
<p>We have two options at our disposal, either use the CDN (as shown in the previous code chunk) or download the file. We will start by making use of the CDN; later when we build a package for this functionality, we shall download it to provide users of the package a choice between using the local file or the CDN.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="shiny-complete.html#cb215-1"></a>dependency_ml5 &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</span>
<span id="cb215-2"><a href="shiny-complete.html#cb215-2"></a>  <span class="dt">name =</span> <span class="st">&quot;ml5&quot;</span>,</span>
<span id="cb215-3"><a href="shiny-complete.html#cb215-3"></a>  <span class="dt">version =</span> <span class="st">&quot;0.4.3&quot;</span>,</span>
<span id="cb215-4"><a href="shiny-complete.html#cb215-4"></a>  <span class="dt">src =</span> <span class="kw">c</span>(<span class="dt">href =</span> <span class="st">&quot;https://unpkg.com/ml5@0.4.3/dist/&quot;</span>),</span>
<span id="cb215-5"><a href="shiny-complete.html#cb215-5"></a>  <span class="dt">script =</span> <span class="st">&quot;ml5.min.js&quot;</span></span>
<span id="cb215-6"><a href="shiny-complete.html#cb215-6"></a>)</span></code></pre></div>
</div>
<div id="shiny-complete-images" class="section level2" number="12.4">
<h2><span class="header-section-number">12.4</span> Static files</h2>
<p>Images will, of course, be necessary in order to test the image classifier, we are therefore going to download some from Wikipedia. The following code chunk creates a directory of assets, downloads images of birds and saves them to the aforementioned directory. For brevity, we limit ourselves to downloading two images, one of a flamingo and another of a lorikeet but feel free to add more. Also, note that the pre-trained image classifier we are going to use in this example is not limited to birds.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="shiny-complete.html#cb216-1"></a><span class="co"># static files directory</span></span>
<span id="cb216-2"><a href="shiny-complete.html#cb216-2"></a><span class="kw">dir.create</span>(<span class="st">&quot;assets&quot;</span>)</span>
<span id="cb216-3"><a href="shiny-complete.html#cb216-3"></a></span>
<span id="cb216-4"><a href="shiny-complete.html#cb216-4"></a><span class="co"># flamingo</span></span>
<span id="cb216-5"><a href="shiny-complete.html#cb216-5"></a>fl &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb216-6"><a href="shiny-complete.html#cb216-6"></a>  <span class="st">&quot;https://upload.wikimedia.org/wikipedia/&quot;</span>,</span>
<span id="cb216-7"><a href="shiny-complete.html#cb216-7"></a>  <span class="st">&quot;commons/thumb/7/72/American_flamingo&quot;</span>,</span>
<span id="cb216-8"><a href="shiny-complete.html#cb216-8"></a>  <span class="st">&quot;_%28Phoenicopterus_ruber%29.JPG/256px-&quot;</span>,</span>
<span id="cb216-9"><a href="shiny-complete.html#cb216-9"></a>  <span class="st">&quot;American_flamingo_%28Phoenicopterus_ruber%29.JPG&quot;</span></span>
<span id="cb216-10"><a href="shiny-complete.html#cb216-10"></a>)</span>
<span id="cb216-11"><a href="shiny-complete.html#cb216-11"></a></span>
<span id="cb216-12"><a href="shiny-complete.html#cb216-12"></a><span class="co"># lorikeet</span></span>
<span id="cb216-13"><a href="shiny-complete.html#cb216-13"></a>lo &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb216-14"><a href="shiny-complete.html#cb216-14"></a>  <span class="st">&quot;https://upload.wikimedia.org/wikipedia/&quot;</span>,</span>
<span id="cb216-15"><a href="shiny-complete.html#cb216-15"></a>  <span class="st">&quot;commons/thumb/c/c2/Rainbow_lorikeet.jpg/&quot;</span>,</span>
<span id="cb216-16"><a href="shiny-complete.html#cb216-16"></a>  <span class="st">&quot;256px-Rainbow_lorikeet.jpg&quot;</span></span>
<span id="cb216-17"><a href="shiny-complete.html#cb216-17"></a>)</span>
<span id="cb216-18"><a href="shiny-complete.html#cb216-18"></a></span>
<span id="cb216-19"><a href="shiny-complete.html#cb216-19"></a><span class="co"># download</span></span>
<span id="cb216-20"><a href="shiny-complete.html#cb216-20"></a><span class="kw">download.file</span>(fl, <span class="dt">destfile =</span> <span class="st">&quot;assets/flamingo.jpg&quot;</span>)</span>
<span id="cb216-21"><a href="shiny-complete.html#cb216-21"></a><span class="kw">download.file</span>(lo, <span class="dt">destfile =</span> <span class="st">&quot;assets/lorikeet.jpg&quot;</span>)</span></code></pre></div>
<p>Finally we should also add a JavaScript file which will eventually contain our custom functions to run the image classifier.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="shiny-complete.html#cb217-1"></a><span class="kw">file.create</span>(<span class="st">&quot;www/classify.js&quot;</span>)</span></code></pre></div>
<p>At this stage one should obtain a directory resembling the tree below.</p>
<pre><code>.
├── app.R
└── assets
    ├── classify.js
    ├── flamingo.JPG
    └── lorikeet.jpg</code></pre>
<p>These files will eventually need to be served (<code>addResourcePath</code>), so they are accessible by the shiny UI.</p>
</div>
<div id="shiny-complete-skeleton" class="section level2" number="12.5">
<h2><span class="header-section-number">12.5</span> Skeleton</h2>
<p>At this stage, it’s probably good to build a skeleton of the application.</p>
<p>After loading the shiny package, we use the <code>addResourcePath</code> function to serve the images so they can be made accessible by the shiny UI to display. At this stage, the application itself only provides a dropdown to select one of the two images previously downloaded, and a button to trigger the classification which currently does not do anything, we’ll delve into this next. Since we placed the <code>classify.js</code> JavaScript file in the <code>assets</code> directory we can also import it in the UI with a <code>script</code> tag; importantly this is done <em>after</em> the ml5.js dependency as it will depend on it. Another crucial thing that the app does is set the attribute <code>id</code> of the <code>&lt;img&gt;</code> to <code>bird</code>, it is essential to have a convenient way to uniquely identify the image later on as ml5.js will need to read this image in order to classify it.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="shiny-complete.html#cb219-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb219-2"><a href="shiny-complete.html#cb219-2"></a></span>
<span id="cb219-3"><a href="shiny-complete.html#cb219-3"></a><span class="co"># serve images</span></span>
<span id="cb219-4"><a href="shiny-complete.html#cb219-4"></a><span class="kw">addResourcePath</span>(<span class="st">&quot;assets&quot;</span>, <span class="st">&quot;assets&quot;</span>)</span>
<span id="cb219-5"><a href="shiny-complete.html#cb219-5"></a></span>
<span id="cb219-6"><a href="shiny-complete.html#cb219-6"></a><span class="co"># ml5js dependency</span></span>
<span id="cb219-7"><a href="shiny-complete.html#cb219-7"></a>dependency_ml5 &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</span>
<span id="cb219-8"><a href="shiny-complete.html#cb219-8"></a>  <span class="dt">name =</span> <span class="st">&quot;ml5&quot;</span>,</span>
<span id="cb219-9"><a href="shiny-complete.html#cb219-9"></a>  <span class="dt">version =</span> <span class="st">&quot;0.4.3&quot;</span>,</span>
<span id="cb219-10"><a href="shiny-complete.html#cb219-10"></a>  <span class="dt">src =</span> <span class="kw">c</span>(<span class="dt">href =</span> <span class="st">&quot;https://unpkg.com/ml5@0.4.3/dist/&quot;</span>),</span>
<span id="cb219-11"><a href="shiny-complete.html#cb219-11"></a>  <span class="dt">script =</span> <span class="st">&quot;ml5.min.js&quot;</span></span>
<span id="cb219-12"><a href="shiny-complete.html#cb219-12"></a>)</span>
<span id="cb219-13"><a href="shiny-complete.html#cb219-13"></a></span>
<span id="cb219-14"><a href="shiny-complete.html#cb219-14"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb219-15"><a href="shiny-complete.html#cb219-15"></a>  dependency_ml5,</span>
<span id="cb219-16"><a href="shiny-complete.html#cb219-16"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb219-17"><a href="shiny-complete.html#cb219-17"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;assets/classify.js&quot;</span>)</span>
<span id="cb219-18"><a href="shiny-complete.html#cb219-18"></a>  ),</span>
<span id="cb219-19"><a href="shiny-complete.html#cb219-19"></a>  <span class="kw">selectInput</span>(</span>
<span id="cb219-20"><a href="shiny-complete.html#cb219-20"></a>    <span class="dt">inputId =</span> <span class="st">&quot;selectedBird&quot;</span>, </span>
<span id="cb219-21"><a href="shiny-complete.html#cb219-21"></a>    <span class="dt">label =</span> <span class="st">&quot;bird&quot;</span>,</span>
<span id="cb219-22"><a href="shiny-complete.html#cb219-22"></a>    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;flamingo&quot;</span>, <span class="st">&quot;lorikeet&quot;</span>)</span>
<span id="cb219-23"><a href="shiny-complete.html#cb219-23"></a>  ),</span>
<span id="cb219-24"><a href="shiny-complete.html#cb219-24"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;classify&quot;</span>, <span class="st">&quot;Classify&quot;</span>),</span>
<span id="cb219-25"><a href="shiny-complete.html#cb219-25"></a>  <span class="kw">uiOutput</span>(<span class="st">&quot;birdDisplay&quot;</span>)</span>
<span id="cb219-26"><a href="shiny-complete.html#cb219-26"></a>)</span>
<span id="cb219-27"><a href="shiny-complete.html#cb219-27"></a></span>
<span id="cb219-28"><a href="shiny-complete.html#cb219-28"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb219-29"><a href="shiny-complete.html#cb219-29"></a></span>
<span id="cb219-30"><a href="shiny-complete.html#cb219-30"></a>  output<span class="op">$</span>birdDisplay &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb219-31"><a href="shiny-complete.html#cb219-31"></a>    path &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;assets/%s.jpg&quot;</span>, input<span class="op">$</span>selectedBird)</span>
<span id="cb219-32"><a href="shiny-complete.html#cb219-32"></a>    tags<span class="op">$</span><span class="kw">img</span>(<span class="dt">src =</span> path, <span class="dt">id =</span> <span class="st">&quot;bird&quot;</span>)</span>
<span id="cb219-33"><a href="shiny-complete.html#cb219-33"></a>  })</span>
<span id="cb219-34"><a href="shiny-complete.html#cb219-34"></a></span>
<span id="cb219-35"><a href="shiny-complete.html#cb219-35"></a>}</span>
<span id="cb219-36"><a href="shiny-complete.html#cb219-36"></a></span>
<span id="cb219-37"><a href="shiny-complete.html#cb219-37"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:shiny-complete-skeleton"></span>
<img src="images/shiny-complete-skeleton.png" alt="Shiny app skeleton" width="100%" />
<p class="caption">
FIGURE 12.1: Shiny app skeleton
</p>
</div>
</div>
<div id="shiny-complete-r2js" class="section level2" number="12.6">
<h2><span class="header-section-number">12.6</span> From R to JavaScript</h2>
<p>What is now left to do is to program the classification. As a reminder, when the “classify” button is clicked, the classification must happen JavaScript-side using ml5.js; this implies that data must travel from R to JavaScript.</p>
<p>This will be carried in a similar fashion as in the previous chapter on alerts; the R server needs to send a message to the front-end so it can trigger the classification using JavaScript.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="shiny-complete.html#cb220-1"></a><span class="kw">observeEvent</span>(input<span class="op">$</span>classify, {</span>
<span id="cb220-2"><a href="shiny-complete.html#cb220-2"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;classify&quot;</span>, <span class="kw">list</span>())</span>
<span id="cb220-3"><a href="shiny-complete.html#cb220-3"></a>})</span></code></pre></div>
<p>We thus observe the button so that when clicked, a message is sent to the front-end, via the WebSocket. Note that the <code>sendCustomMessage</code> method <strong>must take data,</strong> hence the empty <code>list</code> that is used as the second argument. That, of course, won’t do anything as we are yet to add a handler in JavaScript to handle this <code>classify</code> message that is sent.</p>
<p>Looking back at the documentation of ml5.js we observe that before we can classify the image, the model should be loaded: we start by placing this code in the <code>classify.js</code> application.</p>
<p>The classifier is initialised from the <code>imageClassifier</code> method which takes 1) the pre-trained model to use (or its name), 2) a callback function. The callback function is run when the model is done loading, though we don’t make use of it here the argument is not optional (omitting it will raise an error) so we pass a function that simply prints <code>Model Loaded!</code> to the console.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb221-1"><a href="shiny-complete.html#cb221-1"></a><span class="co">// Mandatory callback function</span></span>
<span id="cb221-2"><a href="shiny-complete.html#cb221-2"></a><span class="kw">function</span> <span class="fu">modelLoaded</span>() {</span>
<span id="cb221-3"><a href="shiny-complete.html#cb221-3"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Model Loaded!&#39;</span>)<span class="op">;</span></span>
<span id="cb221-4"><a href="shiny-complete.html#cb221-4"></a>}</span>
<span id="cb221-5"><a href="shiny-complete.html#cb221-5"></a></span>
<span id="cb221-6"><a href="shiny-complete.html#cb221-6"></a><span class="co">// Initialize the Image Classifier method with MobileNet</span></span>
<span id="cb221-7"><a href="shiny-complete.html#cb221-7"></a><span class="kw">const</span> classifier <span class="op">=</span> ml5<span class="op">.</span><span class="fu">imageClassifier</span>(<span class="st">&#39;MobileNet&#39;</span><span class="op">,</span> modelLoaded)<span class="op">;</span></span></code></pre></div>
<div class="rmdnote">
<p>
There is no need to repeatedly initialise the classifier every time a user hits the “classify” button: this should only be done once.
</p>
</div>
<p>Finally, we can take care of the message handler. Remember the message sent from the R server bears the <code>classify</code> unique identifier. The handler function runs the <code>classify</code> method on the previously instantiated <code>classifier</code> object, this takes 1) the image to classify and 2) a callback function to handle the results of the classification. Here we genuinely get to why we gave the generated <code>&lt;img&gt;</code> of the selected bird and <code>id</code>: it helps us quickly select that image from JavaScript to use in the classifier with <code>document.getElementById("bird")</code>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb222-1"><a href="shiny-complete.html#cb222-1"></a><span class="co">// Mandatory callback function</span></span>
<span id="cb222-2"><a href="shiny-complete.html#cb222-2"></a><span class="kw">function</span> <span class="fu">modelLoaded</span>() {</span>
<span id="cb222-3"><a href="shiny-complete.html#cb222-3"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Model Loaded!&#39;</span>)<span class="op">;</span></span>
<span id="cb222-4"><a href="shiny-complete.html#cb222-4"></a>}</span>
<span id="cb222-5"><a href="shiny-complete.html#cb222-5"></a></span>
<span id="cb222-6"><a href="shiny-complete.html#cb222-6"></a><span class="co">// Initialize the Image Classifier method with MobileNet</span></span>
<span id="cb222-7"><a href="shiny-complete.html#cb222-7"></a><span class="kw">const</span> classifier <span class="op">=</span> ml5<span class="op">.</span><span class="fu">imageClassifier</span>(<span class="st">&#39;MobileNet&#39;</span><span class="op">,</span> modelLoaded)<span class="op">;</span></span>
<span id="cb222-8"><a href="shiny-complete.html#cb222-8"></a></span>
<span id="cb222-9"><a href="shiny-complete.html#cb222-9"></a>Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(<span class="st">&#39;classify&#39;</span><span class="op">,</span> <span class="kw">function</span>(data){</span>
<span id="cb222-10"><a href="shiny-complete.html#cb222-10"></a>  <span class="co">// Classify bird</span></span>
<span id="cb222-11"><a href="shiny-complete.html#cb222-11"></a>  classifier<span class="op">.</span><span class="fu">classify</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;bird&quot;</span>)<span class="op">,</span> (err<span class="op">,</span> results) <span class="kw">=&gt;</span> {</span>
<span id="cb222-12"><a href="shiny-complete.html#cb222-12"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(results)</span>
<span id="cb222-13"><a href="shiny-complete.html#cb222-13"></a>  })<span class="op">;</span></span>
<span id="cb222-14"><a href="shiny-complete.html#cb222-14"></a>})<span class="op">;</span></span></code></pre></div>
<p>As mentioned at the start of the chapter, the results of the classification should be sent back to the R server, but for now, we shall content ourselves with logging it in the console.</p>
<p>Running the application and opening the console already gives us encouraging results! The classifier gives “flamingo” the greatest confidence (albeit at <code>0.48</code>).</p>
<div class="figure" style="text-align: center"><span id="fig:shiny-complete-classify-console"></span>
<img src="images/shiny-complete-classify-console.png" alt="Results logged to the console" width="100%" />
<p class="caption">
FIGURE 12.2: Results logged to the console
</p>
</div>
</div>
<div id="shiny-complete-js2r" class="section level2" number="12.7">
<h2><span class="header-section-number">12.7</span> From JavaScript to R</h2>
<p>The application thus classifies the images, but the results remain in the front-end, and we would like to have those results returned to the R server so we can further process them and display them back to the user.</p>
<p>As in the previous chapter, this can be done with the <code>setInputValue</code> function which, as a reminder, will do exactly as advertised: it will set an <code>input</code> with a given value in the R server: the code below will make it such that the <code>results</code> will be accessible in the R server with <code>input$classification</code>.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb223-1"><a href="shiny-complete.html#cb223-1"></a><span class="co">// Mandatory callback function</span></span>
<span id="cb223-2"><a href="shiny-complete.html#cb223-2"></a><span class="kw">function</span> <span class="fu">modelLoaded</span>() {</span>
<span id="cb223-3"><a href="shiny-complete.html#cb223-3"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Model Loaded!&#39;</span>)<span class="op">;</span></span>
<span id="cb223-4"><a href="shiny-complete.html#cb223-4"></a>}</span>
<span id="cb223-5"><a href="shiny-complete.html#cb223-5"></a></span>
<span id="cb223-6"><a href="shiny-complete.html#cb223-6"></a><span class="co">// Initialize the Image Classifier method with MobileNet</span></span>
<span id="cb223-7"><a href="shiny-complete.html#cb223-7"></a><span class="kw">const</span> classifier <span class="op">=</span> ml5<span class="op">.</span><span class="fu">imageClassifier</span>(<span class="st">&#39;MobileNet&#39;</span><span class="op">,</span> modelLoaded)<span class="op">;</span></span>
<span id="cb223-8"><a href="shiny-complete.html#cb223-8"></a></span>
<span id="cb223-9"><a href="shiny-complete.html#cb223-9"></a>Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(<span class="st">&#39;classify&#39;</span><span class="op">,</span> <span class="kw">function</span>(data){</span>
<span id="cb223-10"><a href="shiny-complete.html#cb223-10"></a>  <span class="co">// Classify bird</span></span>
<span id="cb223-11"><a href="shiny-complete.html#cb223-11"></a>  classifier<span class="op">.</span><span class="fu">classify</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;bird&quot;</span>)<span class="op">,</span> (err<span class="op">,</span> results) <span class="kw">=&gt;</span> {</span>
<span id="cb223-12"><a href="shiny-complete.html#cb223-12"></a>    Shiny<span class="op">.</span><span class="fu">setInputValue</span>(<span class="st">&quot;classification&quot;</span><span class="op">,</span> results)</span>
<span id="cb223-13"><a href="shiny-complete.html#cb223-13"></a>  })<span class="op">;</span></span>
<span id="cb223-14"><a href="shiny-complete.html#cb223-14"></a>})<span class="op">;</span></span></code></pre></div>
<p>Now that the results are sent back to the R server, we can use them to display it back in the application so users of the application may know how the model performed. We shall eventually make this prettier, but for now, we’ll limit it to displaying the results in <code>verbatimTextOutput</code>.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="shiny-complete.html#cb224-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb224-2"><a href="shiny-complete.html#cb224-2"></a></span>
<span id="cb224-3"><a href="shiny-complete.html#cb224-3"></a><span class="co"># serve images</span></span>
<span id="cb224-4"><a href="shiny-complete.html#cb224-4"></a><span class="kw">addResourcePath</span>(<span class="st">&quot;assets&quot;</span>, <span class="st">&quot;assets&quot;</span>)</span>
<span id="cb224-5"><a href="shiny-complete.html#cb224-5"></a></span>
<span id="cb224-6"><a href="shiny-complete.html#cb224-6"></a><span class="co"># ml5js dependency</span></span>
<span id="cb224-7"><a href="shiny-complete.html#cb224-7"></a>dependency_ml5 &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</span>
<span id="cb224-8"><a href="shiny-complete.html#cb224-8"></a>  <span class="dt">name =</span> <span class="st">&quot;ml5&quot;</span>,</span>
<span id="cb224-9"><a href="shiny-complete.html#cb224-9"></a>  <span class="dt">version =</span> <span class="st">&quot;0.4.3&quot;</span>,</span>
<span id="cb224-10"><a href="shiny-complete.html#cb224-10"></a>  <span class="dt">src =</span> <span class="kw">c</span>(<span class="dt">href =</span> <span class="st">&quot;https://unpkg.com/ml5@0.4.3/dist/&quot;</span>),</span>
<span id="cb224-11"><a href="shiny-complete.html#cb224-11"></a>  <span class="dt">script =</span> <span class="st">&quot;ml5.min.js&quot;</span></span>
<span id="cb224-12"><a href="shiny-complete.html#cb224-12"></a>)</span>
<span id="cb224-13"><a href="shiny-complete.html#cb224-13"></a></span>
<span id="cb224-14"><a href="shiny-complete.html#cb224-14"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb224-15"><a href="shiny-complete.html#cb224-15"></a>  dependency_ml5,</span>
<span id="cb224-16"><a href="shiny-complete.html#cb224-16"></a>  tags<span class="op">$</span><span class="kw">head</span>(tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;assets/classify.js&quot;</span>)),</span>
<span id="cb224-17"><a href="shiny-complete.html#cb224-17"></a>  <span class="kw">selectInput</span>(</span>
<span id="cb224-18"><a href="shiny-complete.html#cb224-18"></a>    <span class="dt">inputId =</span> <span class="st">&quot;selectedBird&quot;</span>, </span>
<span id="cb224-19"><a href="shiny-complete.html#cb224-19"></a>    <span class="dt">label =</span> <span class="st">&quot;bird&quot;</span>,</span>
<span id="cb224-20"><a href="shiny-complete.html#cb224-20"></a>    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;flamingo&quot;</span>, <span class="st">&quot;lorikeet&quot;</span>)</span>
<span id="cb224-21"><a href="shiny-complete.html#cb224-21"></a>  ),</span>
<span id="cb224-22"><a href="shiny-complete.html#cb224-22"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;classify&quot;</span>, <span class="st">&quot;Classify&quot;</span>),</span>
<span id="cb224-23"><a href="shiny-complete.html#cb224-23"></a>  <span class="kw">uiOutput</span>(<span class="st">&quot;birdDisplay&quot;</span>),</span>
<span id="cb224-24"><a href="shiny-complete.html#cb224-24"></a>  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;results&quot;</span>) <span class="co"># display results</span></span>
<span id="cb224-25"><a href="shiny-complete.html#cb224-25"></a>)</span>
<span id="cb224-26"><a href="shiny-complete.html#cb224-26"></a></span>
<span id="cb224-27"><a href="shiny-complete.html#cb224-27"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb224-28"><a href="shiny-complete.html#cb224-28"></a></span>
<span id="cb224-29"><a href="shiny-complete.html#cb224-29"></a>  output<span class="op">$</span>birdDisplay &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb224-30"><a href="shiny-complete.html#cb224-30"></a>    path &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;assets/%s.jpg&quot;</span>, input<span class="op">$</span>selectedBird)</span>
<span id="cb224-31"><a href="shiny-complete.html#cb224-31"></a>    tags<span class="op">$</span><span class="kw">img</span>(<span class="dt">src =</span> path, <span class="dt">id =</span> <span class="st">&quot;bird&quot;</span>)</span>
<span id="cb224-32"><a href="shiny-complete.html#cb224-32"></a>  })</span>
<span id="cb224-33"><a href="shiny-complete.html#cb224-33"></a></span>
<span id="cb224-34"><a href="shiny-complete.html#cb224-34"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>classify, {</span>
<span id="cb224-35"><a href="shiny-complete.html#cb224-35"></a>    session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;classify&quot;</span>, <span class="kw">list</span>())</span>
<span id="cb224-36"><a href="shiny-complete.html#cb224-36"></a>  })</span>
<span id="cb224-37"><a href="shiny-complete.html#cb224-37"></a></span>
<span id="cb224-38"><a href="shiny-complete.html#cb224-38"></a>  <span class="co"># render results</span></span>
<span id="cb224-39"><a href="shiny-complete.html#cb224-39"></a>  output<span class="op">$</span>results &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb224-40"><a href="shiny-complete.html#cb224-40"></a>    <span class="kw">print</span>(input<span class="op">$</span>classification)</span>
<span id="cb224-41"><a href="shiny-complete.html#cb224-41"></a>  })</span>
<span id="cb224-42"><a href="shiny-complete.html#cb224-42"></a></span>
<span id="cb224-43"><a href="shiny-complete.html#cb224-43"></a>}</span>
<span id="cb224-44"><a href="shiny-complete.html#cb224-44"></a></span>
<span id="cb224-45"><a href="shiny-complete.html#cb224-45"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:shiny-complete-ml5-output"></span>
<img src="images/ml5-output.png" alt="Classifier basic output" width="100%" />
<p class="caption">
FIGURE 12.3: Classifier basic output
</p>
</div>
</div>
<div id="shiny-complete-input-handler" class="section level2" number="12.8">
<h2><span class="header-section-number">12.8</span> Input handler</h2>
<p>In the previous section on sending data from R to JavaScript, we used a “message handler” in JavaScript to handle the data coming from the server. There is also the corollary, an “input handler” to preprocess the data coming from JavaScript before it is made accessible by the input. In R, this is a function that must accept three arguments, the data coming to JavaScript, a shiny session, and the name of the input. Note that all of these arguments are mandatory if they are not used in the function one omit them and use the three-dot construct instead.</p>
<p>Input handlers are most often used to reshape or change the type of the data coming in. To demonstrate how to use them, we will reshape the classification results sent to R as looking at the results of the classification in the R server one might notice a row-wise list which can be transformed into a <code>data.frame</code>. The function below makes use of the <a href="https://github.com/tidyverse/purrr/">purrr</a> <span class="citation">(Henry and Wickham <a href="#ref-R-purrr" role="doc-biblioref">2020</a>)</span> package to loop over every result and transform them into data.frames and return a single data.frame.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="shiny-complete.html#cb225-1"></a><span class="co"># create handler</span></span>
<span id="cb225-2"><a href="shiny-complete.html#cb225-2"></a>process_results &lt;-<span class="st"> </span><span class="cf">function</span>(data, ...){</span>
<span id="cb225-3"><a href="shiny-complete.html#cb225-3"></a>  purrr<span class="op">::</span><span class="kw">map_dfr</span>(data, as.data.frame)</span>
<span id="cb225-4"><a href="shiny-complete.html#cb225-4"></a>}</span></code></pre></div>
<p>Once this function created, it needs to be registered with shiny using the <code>registerInputHandler</code> function, which takes two arguments. First, a unique identifier for the handler, second, the handler function. Attempt to give the handler a unique yet straightforward name (alphanumeric characters, underscores, and periods) to avoid clashes with other handlers.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="shiny-complete.html#cb226-1"></a><span class="co"># register with shiny</span></span>
<span id="cb226-2"><a href="shiny-complete.html#cb226-2"></a>shiny<span class="op">::</span><span class="kw">registerInputHandler</span>(<span class="st">&quot;ml5.class&quot;</span>, process_results)</span></code></pre></div>
<p>Note that handlers can only be registered once, running the above twice will fail the second time, even if the handler function has changed. This is to ensure one does not accidentally overwrite handlers brought in by other packages. These can be overwritten by explicitly setting <code>force</code> to <code>TRUE</code>, but it is not advised.</p>
<div class="rmdnote">
<p>
It is not advised to overwrite the registered handler.
</p>
</div>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="shiny-complete.html#cb227-1"></a><span class="co"># register with shiny</span></span>
<span id="cb227-2"><a href="shiny-complete.html#cb227-2"></a><span class="kw">registerInputHandler</span>(<span class="st">&quot;ml5.class&quot;</span>, process_results)</span></code></pre></div>
<p>Once the handler function created and registered with shiny what is left to do is tell shiny which input should use that handler. This is done by adding the name of the handler, <code>ml5.class</code>, preceded by a colon (<code>:ml5.class</code>) as a suffix to the input name.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb228-1"><a href="shiny-complete.html#cb228-1"></a>Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(<span class="st">&#39;classify&#39;</span><span class="op">,</span> <span class="kw">function</span>(data){</span>
<span id="cb228-2"><a href="shiny-complete.html#cb228-2"></a>  <span class="co">// Classify bird</span></span>
<span id="cb228-3"><a href="shiny-complete.html#cb228-3"></a>  classifier<span class="op">.</span><span class="fu">classify</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;bird&quot;</span>)<span class="op">,</span> (err<span class="op">,</span> results) <span class="kw">=&gt;</span> {</span>
<span id="cb228-4"><a href="shiny-complete.html#cb228-4"></a>    Shiny<span class="op">.</span><span class="fu">setInputValue</span>(<span class="st">&quot;classification:ml5.class&quot;</span><span class="op">,</span> results)<span class="op">;</span></span>
<span id="cb228-5"><a href="shiny-complete.html#cb228-5"></a>  })<span class="op">;</span></span>
<span id="cb228-6"><a href="shiny-complete.html#cb228-6"></a>})<span class="op">;</span></span></code></pre></div>
<p>Now that the results of <code>input$classification</code> is a data.frame we can display the results in a neat table instead.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="shiny-complete.html#cb229-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb229-2"><a href="shiny-complete.html#cb229-2"></a></span>
<span id="cb229-3"><a href="shiny-complete.html#cb229-3"></a><span class="co"># serve images</span></span>
<span id="cb229-4"><a href="shiny-complete.html#cb229-4"></a><span class="kw">addResourcePath</span>(<span class="st">&quot;assets&quot;</span>, <span class="st">&quot;assets&quot;</span>)</span>
<span id="cb229-5"><a href="shiny-complete.html#cb229-5"></a></span>
<span id="cb229-6"><a href="shiny-complete.html#cb229-6"></a><span class="co"># create handler</span></span>
<span id="cb229-7"><a href="shiny-complete.html#cb229-7"></a>handler &lt;-<span class="st"> </span><span class="cf">function</span>(data, ...){</span>
<span id="cb229-8"><a href="shiny-complete.html#cb229-8"></a>  purrr<span class="op">::</span><span class="kw">map_dfr</span>(data, as.data.frame)</span>
<span id="cb229-9"><a href="shiny-complete.html#cb229-9"></a>}</span>
<span id="cb229-10"><a href="shiny-complete.html#cb229-10"></a></span>
<span id="cb229-11"><a href="shiny-complete.html#cb229-11"></a><span class="co"># register with shiny</span></span>
<span id="cb229-12"><a href="shiny-complete.html#cb229-12"></a>shiny<span class="op">::</span><span class="kw">registerInputHandler</span>(<span class="st">&quot;ml5.class&quot;</span>, handler)</span>
<span id="cb229-13"><a href="shiny-complete.html#cb229-13"></a></span>
<span id="cb229-14"><a href="shiny-complete.html#cb229-14"></a><span class="co"># ml5js dependency</span></span>
<span id="cb229-15"><a href="shiny-complete.html#cb229-15"></a>dependency_ml5 &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</span>
<span id="cb229-16"><a href="shiny-complete.html#cb229-16"></a>  <span class="dt">name =</span> <span class="st">&quot;ml5&quot;</span>,</span>
<span id="cb229-17"><a href="shiny-complete.html#cb229-17"></a>  <span class="dt">version =</span> <span class="st">&quot;0.4.3&quot;</span>,</span>
<span id="cb229-18"><a href="shiny-complete.html#cb229-18"></a>  <span class="dt">src =</span> <span class="kw">c</span>(<span class="dt">href =</span> <span class="st">&quot;https://unpkg.com/ml5@0.4.3/dist/&quot;</span>),</span>
<span id="cb229-19"><a href="shiny-complete.html#cb229-19"></a>  <span class="dt">script =</span> <span class="st">&quot;ml5.min.js&quot;</span></span>
<span id="cb229-20"><a href="shiny-complete.html#cb229-20"></a>)</span>
<span id="cb229-21"><a href="shiny-complete.html#cb229-21"></a></span>
<span id="cb229-22"><a href="shiny-complete.html#cb229-22"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb229-23"><a href="shiny-complete.html#cb229-23"></a>  dependency_ml5,</span>
<span id="cb229-24"><a href="shiny-complete.html#cb229-24"></a>  tags<span class="op">$</span><span class="kw">head</span>(tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;assets/classify.js&quot;</span>)),</span>
<span id="cb229-25"><a href="shiny-complete.html#cb229-25"></a>  <span class="kw">selectInput</span>(</span>
<span id="cb229-26"><a href="shiny-complete.html#cb229-26"></a>    <span class="dt">inputId =</span> <span class="st">&quot;selectedBird&quot;</span>, </span>
<span id="cb229-27"><a href="shiny-complete.html#cb229-27"></a>    <span class="dt">label =</span> <span class="st">&quot;bird&quot;</span>,</span>
<span id="cb229-28"><a href="shiny-complete.html#cb229-28"></a>    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;flamingo&quot;</span>, <span class="st">&quot;lorikeet&quot;</span>)</span>
<span id="cb229-29"><a href="shiny-complete.html#cb229-29"></a>  ),</span>
<span id="cb229-30"><a href="shiny-complete.html#cb229-30"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;classify&quot;</span>, <span class="st">&quot;Classify&quot;</span>),</span>
<span id="cb229-31"><a href="shiny-complete.html#cb229-31"></a>  <span class="kw">uiOutput</span>(<span class="st">&quot;birdDisplay&quot;</span>),</span>
<span id="cb229-32"><a href="shiny-complete.html#cb229-32"></a>  <span class="kw">tableOutput</span>(<span class="st">&quot;results&quot;</span>)</span>
<span id="cb229-33"><a href="shiny-complete.html#cb229-33"></a>)</span>
<span id="cb229-34"><a href="shiny-complete.html#cb229-34"></a></span>
<span id="cb229-35"><a href="shiny-complete.html#cb229-35"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb229-36"><a href="shiny-complete.html#cb229-36"></a></span>
<span id="cb229-37"><a href="shiny-complete.html#cb229-37"></a>  output<span class="op">$</span>birdDisplay &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb229-38"><a href="shiny-complete.html#cb229-38"></a>    path &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;assets/%s.jpg&quot;</span>, input<span class="op">$</span>selectedBird)</span>
<span id="cb229-39"><a href="shiny-complete.html#cb229-39"></a>    tags<span class="op">$</span><span class="kw">img</span>(<span class="dt">src =</span> path, <span class="dt">id =</span> <span class="st">&quot;bird&quot;</span>)</span>
<span id="cb229-40"><a href="shiny-complete.html#cb229-40"></a>  })</span>
<span id="cb229-41"><a href="shiny-complete.html#cb229-41"></a></span>
<span id="cb229-42"><a href="shiny-complete.html#cb229-42"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>classify, {</span>
<span id="cb229-43"><a href="shiny-complete.html#cb229-43"></a>    session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;classify&quot;</span>, <span class="kw">list</span>())</span>
<span id="cb229-44"><a href="shiny-complete.html#cb229-44"></a>  })</span>
<span id="cb229-45"><a href="shiny-complete.html#cb229-45"></a></span>
<span id="cb229-46"><a href="shiny-complete.html#cb229-46"></a>  output<span class="op">$</span>results &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb229-47"><a href="shiny-complete.html#cb229-47"></a>    input<span class="op">$</span>classification</span>
<span id="cb229-48"><a href="shiny-complete.html#cb229-48"></a>  })</span>
<span id="cb229-49"><a href="shiny-complete.html#cb229-49"></a></span>
<span id="cb229-50"><a href="shiny-complete.html#cb229-50"></a>}</span>
<span id="cb229-51"><a href="shiny-complete.html#cb229-51"></a></span>
<span id="cb229-52"><a href="shiny-complete.html#cb229-52"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:shiny-complete-table-output"></span>
<img src="images/shiny-complete-table.png" alt="Classifier table output" width="100%" />
<p class="caption">
FIGURE 12.4: Classifier table output
</p>
</div>
</div>
<div id="shiny-complete-pkg" class="section level2" number="12.9">
<h2><span class="header-section-number">12.9</span> As a package</h2>
<p>This chapter thus far built a nice application but the code written is hardly portable; were one to make use of the image classifier from ml5.js in another application everything would have to be rewritten or copy-pasted which hardly good practice and not remotely convenient. Instead this code should be packaged, so it is easily reusable and shareable. Moreover, this will benefit from all the other advantages that R packages bring to code such as documentation, reproducibility, and tests. This also forces the developer to think about the code differently, as we’ll discover it’s not as simple as wrapping individual functionalities from the app into functions.</p>
<p>Before we delve into building the package, let us think through what it should include. The application using ml5 gives some indication as to what the package will look like. Users of the package should be able to reproduce what is executed in the application, namely import dependencies (including the “message handler”), send data to the JavaScript front-end to trigger the classification, and then obtain the results in the R server.</p>
<p>We start by creating a package called <code>ml5</code>.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="shiny-complete.html#cb230-1"></a>usethis<span class="op">::</span><span class="kw">create_package</span>(<span class="st">&quot;ml5&quot;</span>)</span></code></pre></div>
<div id="shiny-complete-pkg-deps" class="section level3" number="12.9.1">
<h3><span class="header-section-number">12.9.1</span> Dependencies</h3>
<p>In the application, the web-hosted dependencies (CDN) were used. There are two advantages to using CDNs: 1) it’s just convenient as one does not have to download them, 2) it’s fast, CDNs are distributed geographically to improve the speed at which they serve the dependencies and will therefore generally outperform the alternative, serving the files locally. This may raise questions when building a package though as one generally want these to be as modular, self-contained, and reproducible as possible and none of these things go well with the idea of a remotely served dependency that is absolutely central to the package. The package should therefore provide both ways of importing dependencies: via the CDN or using locally stored files. The former will be faster while the latter can be used as a fallback in the event there is an issue with the CDN or one does not have internet for instance.</p>
<p>We can download the dependency hosted on the CDN and place it in the <code>inst</code> directory of the package. We also create another JavaScript <code>classify.js</code> that will contain the custom JavaScript code (message handler, etc.) as was done for the application.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="shiny-complete.html#cb231-1"></a><span class="co"># create directory</span></span>
<span id="cb231-2"><a href="shiny-complete.html#cb231-2"></a><span class="kw">dir.create</span>(<span class="st">&quot;inst&quot;</span>)</span>
<span id="cb231-3"><a href="shiny-complete.html#cb231-3"></a></span>
<span id="cb231-4"><a href="shiny-complete.html#cb231-4"></a><span class="co"># download dependency</span></span>
<span id="cb231-5"><a href="shiny-complete.html#cb231-5"></a>uri &lt;-<span class="st"> &quot;https://unpkg.com/ml5@0.4.3/dist/ml5.min.js&quot;</span></span>
<span id="cb231-6"><a href="shiny-complete.html#cb231-6"></a><span class="kw">download.file</span>(uri, <span class="dt">destfile =</span> <span class="st">&quot;inst/ml5.min.js&quot;</span>)</span>
<span id="cb231-7"><a href="shiny-complete.html#cb231-7"></a></span>
<span id="cb231-8"><a href="shiny-complete.html#cb231-8"></a><span class="co"># create js file </span></span>
<span id="cb231-9"><a href="shiny-complete.html#cb231-9"></a><span class="kw">file.create</span>(<span class="st">&quot;inst/classify.js&quot;</span>)</span></code></pre></div>
<p>With the dependencies locally downloaded one can move on to create the R function that will be used to import the dependencies in the shiny UI. The file <code>classify.js</code> should be imported via this function too. The function <code>useMl5</code> creates two <code>html_dependency</code> objects, one for the custom code with the message handler and another for the ml5 dependency, importantly at the end of the function these are returned in a <code>tagList</code> <strong>where order matters</strong> as these will be rendered in the order they are listed: first the ml5 dependency then the file containing our custom code.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="shiny-complete.html#cb232-1"></a><span class="co"># R/deps.R</span></span>
<span id="cb232-2"><a href="shiny-complete.html#cb232-2"></a><span class="co">#&#39; @export</span></span>
<span id="cb232-3"><a href="shiny-complete.html#cb232-3"></a>useMl5 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">cdn =</span> <span class="ot">TRUE</span>) {</span>
<span id="cb232-4"><a href="shiny-complete.html#cb232-4"></a></span>
<span id="cb232-5"><a href="shiny-complete.html#cb232-5"></a>  <span class="co"># internal classify.js file</span></span>
<span id="cb232-6"><a href="shiny-complete.html#cb232-6"></a>  pkg &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</span>
<span id="cb232-7"><a href="shiny-complete.html#cb232-7"></a>    <span class="dt">name =</span> <span class="st">&quot;ml5-pkg&quot;</span>,</span>
<span id="cb232-8"><a href="shiny-complete.html#cb232-8"></a>    <span class="dt">version =</span> <span class="st">&quot;1.0.0&quot;</span>,</span>
<span id="cb232-9"><a href="shiny-complete.html#cb232-9"></a>    <span class="dt">src =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb232-10"><a href="shiny-complete.html#cb232-10"></a>    <span class="dt">script =</span> <span class="kw">c</span>(<span class="dt">file =</span> <span class="st">&quot;classify.js&quot;</span>),</span>
<span id="cb232-11"><a href="shiny-complete.html#cb232-11"></a>    <span class="dt">package =</span> <span class="st">&quot;ml5&quot;</span></span>
<span id="cb232-12"><a href="shiny-complete.html#cb232-12"></a>  )</span>
<span id="cb232-13"><a href="shiny-complete.html#cb232-13"></a></span>
<span id="cb232-14"><a href="shiny-complete.html#cb232-14"></a>  <span class="co"># ml5 dependency</span></span>
<span id="cb232-15"><a href="shiny-complete.html#cb232-15"></a>  <span class="cf">if</span>(cdn)</span>
<span id="cb232-16"><a href="shiny-complete.html#cb232-16"></a>    ml5 &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</span>
<span id="cb232-17"><a href="shiny-complete.html#cb232-17"></a>      <span class="dt">name =</span> <span class="st">&quot;ml5&quot;</span>,</span>
<span id="cb232-18"><a href="shiny-complete.html#cb232-18"></a>      <span class="dt">version =</span> <span class="st">&quot;0.4.3&quot;</span>,</span>
<span id="cb232-19"><a href="shiny-complete.html#cb232-19"></a>      <span class="dt">src =</span> <span class="kw">c</span>(<span class="dt">href =</span> <span class="st">&quot;https://unpkg.com/ml5@0.4.3/dist/&quot;</span>),</span>
<span id="cb232-20"><a href="shiny-complete.html#cb232-20"></a>      <span class="dt">script =</span> <span class="st">&quot;ml5.min.js&quot;</span></span>
<span id="cb232-21"><a href="shiny-complete.html#cb232-21"></a>    )</span>
<span id="cb232-22"><a href="shiny-complete.html#cb232-22"></a>  <span class="cf">else</span> </span>
<span id="cb232-23"><a href="shiny-complete.html#cb232-23"></a>    ml5 &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">htmlDependency</span>(</span>
<span id="cb232-24"><a href="shiny-complete.html#cb232-24"></a>      <span class="dt">name =</span> <span class="st">&quot;ml5&quot;</span>,</span>
<span id="cb232-25"><a href="shiny-complete.html#cb232-25"></a>      <span class="dt">version =</span> <span class="st">&quot;0.4.3&quot;</span>,</span>
<span id="cb232-26"><a href="shiny-complete.html#cb232-26"></a>      <span class="dt">src =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb232-27"><a href="shiny-complete.html#cb232-27"></a>      <span class="dt">script =</span> <span class="kw">c</span>(<span class="dt">file =</span> <span class="st">&quot;ml5.min.js&quot;</span>),</span>
<span id="cb232-28"><a href="shiny-complete.html#cb232-28"></a>      <span class="dt">package =</span> <span class="st">&quot;ml5&quot;</span></span>
<span id="cb232-29"><a href="shiny-complete.html#cb232-29"></a>    )</span>
<span id="cb232-30"><a href="shiny-complete.html#cb232-30"></a></span>
<span id="cb232-31"><a href="shiny-complete.html#cb232-31"></a>  htmltools<span class="op">::</span><span class="kw">tagList</span>(ml5, pkg)</span>
<span id="cb232-32"><a href="shiny-complete.html#cb232-32"></a>}</span></code></pre></div>
</div>
<div id="shiny-complete-pkg-trigger" class="section level3" number="12.9.2">
<h3><span class="header-section-number">12.9.2</span> Trigger classification</h3>
<p>There will be a need for a function that sends a message to the front-end to trigger the classification. In the application built previously the <code>id</code> of the image to classify was hard-coded, this must be changed when building a package.</p>
<p>First, this will give users a much better interface where they may use whatever <code>id</code> suits them rather. Second, this will allow using the model to classify images that may be placed in different places and bear different ids.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="shiny-complete.html#cb233-1"></a><span class="co"># R/classify.R</span></span>
<span id="cb233-2"><a href="shiny-complete.html#cb233-2"></a><span class="co">#&#39; @export</span></span>
<span id="cb233-3"><a href="shiny-complete.html#cb233-3"></a>classify &lt;-<span class="st"> </span><span class="cf">function</span>(id, <span class="dt">session =</span> shiny<span class="op">::</span><span class="kw">getDefaultReactiveDomain</span>()){</span>
<span id="cb233-4"><a href="shiny-complete.html#cb233-4"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;ml5-classify&quot;</span>, id)</span>
<span id="cb233-5"><a href="shiny-complete.html#cb233-5"></a>}</span></code></pre></div>
</div>
<div id="shiny-complete-pkg-js-code" class="section level3" number="12.9.3">
<h3><span class="header-section-number">12.9.3</span> JavaScript code</h3>
<p>As a quick reminder, the JavaScript should initialise the model and provide a handler for the message <code>ml5-classify</code> that was defined in the previous section. Nothing needs to change with regard to the initialisation of the model. However, there are two things to adapt in the message handler. First, the <code>id</code> of the image to classify is now dynamically defined and passed from the R server; the code should therefore read <code>document.getElementById(data)</code> (where data is passed from the server) instead of <code>document.getElementById('birds')</code> as was previously hard-coded in the application.</p>
<p>Second, the application also had hardcoded the input id that was set with the results of the classification (<code>input$classification</code>) this will no longer work in a package: given the ability to classify multiple images the results of that classification should set different inputs so as not to overwrite one another. In the code below we therefore create a dynamic input using the id: <code>id</code> + <code>_classification</code>. Note that one can concatenate string in JavaScript using <code>+</code> while in R one would have to use the <code>paste0</code> function.</p>
<p>Examples:</p>
<ul>
<li>Classify image with <code>id = 'birds'</code> will return results to <code>input$birds_classification</code></li>
<li>Classify image with <code>id = 'things'</code> will return results to <code>input$things_classification</code></li>
</ul>
<div class="sourceCode" id="cb234"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb234-1"><a href="shiny-complete.html#cb234-1"></a><span class="co">// Initialize the Image Classifier method with MobileNet</span></span>
<span id="cb234-2"><a href="shiny-complete.html#cb234-2"></a><span class="kw">const</span> classifier <span class="op">=</span> ml5<span class="op">.</span><span class="fu">imageClassifier</span>(<span class="st">&#39;MobileNet&#39;</span><span class="op">,</span> modelLoaded)<span class="op">;</span></span>
<span id="cb234-3"><a href="shiny-complete.html#cb234-3"></a><span class="co">// When the model is loaded</span></span>
<span id="cb234-4"><a href="shiny-complete.html#cb234-4"></a><span class="kw">function</span> <span class="fu">modelLoaded</span>() {</span>
<span id="cb234-5"><a href="shiny-complete.html#cb234-5"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Model Loaded!&#39;</span>)<span class="op">;</span></span>
<span id="cb234-6"><a href="shiny-complete.html#cb234-6"></a>}</span>
<span id="cb234-7"><a href="shiny-complete.html#cb234-7"></a></span>
<span id="cb234-8"><a href="shiny-complete.html#cb234-8"></a>Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(<span class="st">&#39;ml5-classify&#39;</span><span class="op">,</span> <span class="kw">function</span>(data){</span>
<span id="cb234-9"><a href="shiny-complete.html#cb234-9"></a>  <span class="co">// Make a prediction with a selected image</span></span>
<span id="cb234-10"><a href="shiny-complete.html#cb234-10"></a>  classifier<span class="op">.</span><span class="fu">classify</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(data)<span class="op">,</span> (err<span class="op">,</span> results) <span class="kw">=&gt;</span> {</span>
<span id="cb234-11"><a href="shiny-complete.html#cb234-11"></a>    Shiny<span class="op">.</span><span class="fu">setInputValue</span>(data <span class="op">+</span> <span class="st">&quot;_classification:ml5.class&quot;</span><span class="op">,</span> results)<span class="op">;</span></span>
<span id="cb234-12"><a href="shiny-complete.html#cb234-12"></a>  })<span class="op">;</span></span>
<span id="cb234-13"><a href="shiny-complete.html#cb234-13"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="shiny-complete-pkg-input-handler" class="section level3" number="12.9.4">
<h3><span class="header-section-number">12.9.4</span> Input handler</h3>
<p>As mentioned the input handler that transforms the result sent from JavaScript to R into a data.frame can only be registered once. Therefore placing the code that was written in an R file in the package will not work, or rather will work only once.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="shiny-complete.html#cb235-1"></a><span class="co"># R/handler.R</span></span>
<span id="cb235-2"><a href="shiny-complete.html#cb235-2"></a>handler &lt;-<span class="st"> </span><span class="cf">function</span>(data, ...){</span>
<span id="cb235-3"><a href="shiny-complete.html#cb235-3"></a>  purrr<span class="op">::</span><span class="kw">map_dfr</span>(data, as.data.frame)</span>
<span id="cb235-4"><a href="shiny-complete.html#cb235-4"></a>}</span>
<span id="cb235-5"><a href="shiny-complete.html#cb235-5"></a></span>
<span id="cb235-6"><a href="shiny-complete.html#cb235-6"></a><span class="co"># This will error</span></span>
<span id="cb235-7"><a href="shiny-complete.html#cb235-7"></a><span class="co"># register with shiny</span></span>
<span id="cb235-8"><a href="shiny-complete.html#cb235-8"></a>shiny<span class="op">::</span><span class="kw">registerInputHandler</span>(<span class="st">&quot;ml5.class&quot;</span>, handler)</span></code></pre></div>
<p>When the library is loaded the first time it will work but all subsequent attempts will fails.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="shiny-complete.html#cb236-1"></a><span class="kw">library</span>(ml5)</span>
<span id="cb236-2"><a href="shiny-complete.html#cb236-2"></a></span>
<span id="cb236-3"><a href="shiny-complete.html#cb236-3"></a><span class="co">#&gt; Loading ml5</span></span>
<span id="cb236-4"><a href="shiny-complete.html#cb236-4"></a></span>
<span id="cb236-5"><a href="shiny-complete.html#cb236-5"></a><span class="kw">library</span>(ml5)</span>
<span id="cb236-6"><a href="shiny-complete.html#cb236-6"></a></span>
<span id="cb236-7"><a href="shiny-complete.html#cb236-7"></a><span class="co">#&gt; Loading ml5</span></span>
<span id="cb236-8"><a href="shiny-complete.html#cb236-8"></a><span class="co">#&gt; Error in shiny::registerInputHandler(&quot;ml5.class&quot;, handler) : </span></span>
<span id="cb236-9"><a href="shiny-complete.html#cb236-9"></a><span class="co">#&gt;   There is already an input handler for type: ml5.class</span></span></code></pre></div>
<p>Packages can run functions when they are loaded or attached an <code>.onLoad</code> function which is called when the library is loaded in the global environment. The difference between loading and attaching a package can be subtle, in this case, it’s probably best to run the function when the package is loaded using .onLoad which the R Packages book describes as:</p>
<blockquote>
<p>Loading will load code, data and any DLLs; register S3 and S4 methods; and run the .onLoad() function. After loading, the package is available in memory, but because it’s not in the search path, you won’t be able to access its components without using ::. Confusingly, :: will also load a package automatically if it isn’t already loaded. It’s rare to load a package explicitly, but you can do so with requireNamespace() or loadNamespace().</p>
</blockquote>
<p>— <a href="https://r-pkgs.org/">R Packages Book</a></p>
<p>This could be used here to ensure the handler is only registered once; calling <code>library(packageName)</code> twice <em>does not</em> load the package twice, the second time it runs the function observes that the package is already loaded and thus does not load it again. The <code>.onLoad</code> replacement function may accept <code>libname</code> and <code>pkgname</code> arguments, we simplify the function to using <code>...</code> as we do not need those arguments.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="shiny-complete.html#cb237-1"></a><span class="co"># create handler</span></span>
<span id="cb237-2"><a href="shiny-complete.html#cb237-2"></a>handler &lt;-<span class="st"> </span><span class="cf">function</span>(data, ...){</span>
<span id="cb237-3"><a href="shiny-complete.html#cb237-3"></a>  purrr<span class="op">::</span><span class="kw">map_dfr</span>(data, as.data.frame)</span>
<span id="cb237-4"><a href="shiny-complete.html#cb237-4"></a>}</span>
<span id="cb237-5"><a href="shiny-complete.html#cb237-5"></a></span>
<span id="cb237-6"><a href="shiny-complete.html#cb237-6"></a><span class="co"># register with shiny</span></span>
<span id="cb237-7"><a href="shiny-complete.html#cb237-7"></a>.onLoad &lt;-<span class="st"> </span><span class="cf">function</span>(...){</span>
<span id="cb237-8"><a href="shiny-complete.html#cb237-8"></a>  shiny<span class="op">::</span><span class="kw">registerInputHandler</span>(<span class="st">&quot;ml5.class&quot;</span>, handler)</span>
<span id="cb237-9"><a href="shiny-complete.html#cb237-9"></a>}</span></code></pre></div>
</div>
<div id="shiny-complete-pkg-test" class="section level3" number="12.9.5">
<h3><span class="header-section-number">12.9.5</span> Test</h3>
<p>This is about all that is needed in order to build the package; one can then run <code>devtools::document()</code> to produce the man files and populate the namespace with the exported functions then install the package with <code>devtools::install()</code> in order to test it.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="shiny-complete.html#cb238-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb238-2"><a href="shiny-complete.html#cb238-2"></a><span class="kw">library</span>(ml5)</span>
<span id="cb238-3"><a href="shiny-complete.html#cb238-3"></a><span class="kw">library</span>(shiny)</span>
<span id="cb238-4"><a href="shiny-complete.html#cb238-4"></a></span>
<span id="cb238-5"><a href="shiny-complete.html#cb238-5"></a><span class="kw">addResourcePath</span>(<span class="st">&quot;assets&quot;</span>, <span class="st">&quot;assets&quot;</span>)</span>
<span id="cb238-6"><a href="shiny-complete.html#cb238-6"></a></span>
<span id="cb238-7"><a href="shiny-complete.html#cb238-7"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb238-8"><a href="shiny-complete.html#cb238-8"></a>  <span class="kw">useMl5</span>(),</span>
<span id="cb238-9"><a href="shiny-complete.html#cb238-9"></a>  <span class="kw">selectInput</span>(</span>
<span id="cb238-10"><a href="shiny-complete.html#cb238-10"></a>    <span class="dt">inputId =</span> <span class="st">&quot;selectedBird&quot;</span>, </span>
<span id="cb238-11"><a href="shiny-complete.html#cb238-11"></a>    <span class="dt">label =</span> <span class="st">&quot;bird&quot;</span>,</span>
<span id="cb238-12"><a href="shiny-complete.html#cb238-12"></a>    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;flamingo&quot;</span>, <span class="st">&quot;lorikeet&quot;</span>)</span>
<span id="cb238-13"><a href="shiny-complete.html#cb238-13"></a>  ),</span>
<span id="cb238-14"><a href="shiny-complete.html#cb238-14"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;classify&quot;</span>, <span class="st">&quot;Classify&quot;</span>),</span>
<span id="cb238-15"><a href="shiny-complete.html#cb238-15"></a>  <span class="kw">uiOutput</span>(<span class="st">&quot;birdDisplay&quot;</span>),</span>
<span id="cb238-16"><a href="shiny-complete.html#cb238-16"></a>  <span class="kw">DTOutput</span>(<span class="st">&quot;results&quot;</span>)</span>
<span id="cb238-17"><a href="shiny-complete.html#cb238-17"></a>)</span>
<span id="cb238-18"><a href="shiny-complete.html#cb238-18"></a></span>
<span id="cb238-19"><a href="shiny-complete.html#cb238-19"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb238-20"><a href="shiny-complete.html#cb238-20"></a></span>
<span id="cb238-21"><a href="shiny-complete.html#cb238-21"></a>  output<span class="op">$</span>birdDisplay &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb238-22"><a href="shiny-complete.html#cb238-22"></a>    path &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;assets/%s.jpg&quot;</span>, input<span class="op">$</span>selectedBird)</span>
<span id="cb238-23"><a href="shiny-complete.html#cb238-23"></a>    tags<span class="op">$</span><span class="kw">img</span>(<span class="dt">src =</span> path, <span class="dt">id =</span> <span class="st">&quot;bird&quot;</span>)</span>
<span id="cb238-24"><a href="shiny-complete.html#cb238-24"></a>  })</span>
<span id="cb238-25"><a href="shiny-complete.html#cb238-25"></a></span>
<span id="cb238-26"><a href="shiny-complete.html#cb238-26"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>classify, {</span>
<span id="cb238-27"><a href="shiny-complete.html#cb238-27"></a>    <span class="kw">classify</span>(<span class="st">&quot;bird&quot;</span>)</span>
<span id="cb238-28"><a href="shiny-complete.html#cb238-28"></a>  })</span>
<span id="cb238-29"><a href="shiny-complete.html#cb238-29"></a></span>
<span id="cb238-30"><a href="shiny-complete.html#cb238-30"></a>  output<span class="op">$</span>results &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</span>
<span id="cb238-31"><a href="shiny-complete.html#cb238-31"></a>    <span class="kw">datatable</span>(input<span class="op">$</span>bird_classification)</span>
<span id="cb238-32"><a href="shiny-complete.html#cb238-32"></a>  })</span>
<span id="cb238-33"><a href="shiny-complete.html#cb238-33"></a></span>
<span id="cb238-34"><a href="shiny-complete.html#cb238-34"></a>}</span>
<span id="cb238-35"><a href="shiny-complete.html#cb238-35"></a></span>
<span id="cb238-36"><a href="shiny-complete.html#cb238-36"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-purrr">
<p>Henry, Lionel, and Hadley Wickham. 2020. <em>Purrr: Functional Programming Tools</em>. <a href="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="shiny-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="shiny-tips.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/JohnCoene/javascript-for-r/edit/master/4-12-shiny-complete.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
